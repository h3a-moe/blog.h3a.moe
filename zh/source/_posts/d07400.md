---
title: 用 systemd-resolved 支持 DNS over TLS
date: 2021-10-18 19:12:21
updated: 2021-10-19 00:37:15
categories:

tags:
- Linux
- DNS
description:
  NetworkManager 真難對付。
---

{% btn '/en/src/d07400',View in English,,blue larger %}

---

# 动机

用 `DNS over TLS` 避免可能的审查和投毒。



# 过程

迫使 `NetworkManager` 用 `systemd-resolved` 解析域名。

```shell
sudo vim /etc/NetworkManager/NetworkManager.conf
```

加上这个内容

```ini
[main]
dns=systemd-resolved
```

保存，退出。然后把 `DoT` 启用一下。

```shell
sudo vim /etc/systemd/resolved.conf
```

添加内容

```conf
DNS=1.0.0.1 1.1.1.1 45.11.45.11
DNSOverTLS=yes
```

我在这里用了 `cloudflare` 和 `dns.sb`, 但是这不是仅有的选择。

只要服务器支持，你也可以打开 `DNSSEC` 验证。

另外，你可能还要修改下 `/etc/resolv.conf`.

```shell
sudo vim /etc/resolv.conf
```

注释掉其它服务器，然后加上

```shell
nameservers 127.0.0.53
```

保存，并开启写保护。

```shell
sudo chattr +i /etc/resolv.conf
```

然后启动 `systemd-resolved` 并重启 `NetworkManager`.

```shell
sudo systemctl enable --now systemd-resolved
sudo systemctl restart NetworkManager
```

应该工作了。



# P. S.

**延迟会 *显著* 上升。** 

我之前不小心打错字了。

D N A

